# Project Management Suite — User guide

This guide walks each persona through the major areas of the suite. Every section highlights key actions, guardrails, and configuration touchpoints so operators can reason about what happens behind the scenes.

## 1. Personas and access

| Persona | Core responsibilities | Modules with edit rights | View-only access |
| --- | --- | --- | --- |
| **Administrators** | Tenant configuration, user lifecycle, process governance | Admin centre (users, categories, lookups, analytics), Projects, Calendar, Celebrations, Tasks, Process designer, Notifications | All modules |
| **Heads of Department (HoD)** | Approve project plans, manage departmental calendar, maintain process checklists | Projects (stage approvals, plan review), Calendar, Process designer, Holidays | Tasks, Celebrations, Notifications |
| **Project Officers (PO)** | Prepare project data, update procurement facts, draft plans | Projects (facts, plans, comments, photos), Tasks | Calendar (read/write own events), Celebrations |
| **Teaching Assistants (TA)** | Maintain celebrations and shared calendar logistics | Celebrations, Calendar, Tasks | Projects (read), Notifications |
| **Staff** | Manage personal tasks, follow announcements | Tasks, Dashboard widgets | Calendar (read), Celebrations (read), Notifications |

Role membership is managed under **Admin → Users** with guardrails that prevent disabling or demoting the last active Administrator.【F:Areas/Admin/Pages/Users/Index.cshtml.cs†L14-L87】【F:Services/UserManagementService.cs†L20-L210】

## 2. Dashboard

After signing in, everyone lands on **Dashboard → Overview**:

- **My Tasks widget** – Shows the top 20 open tasks grouped into _Overdue_, _Today_, and _Upcoming_. Quick-add tokens (`today`, `tomorrow`, `mon`, `next mon`, `!high`, `!low`) set due dates and priority while removing the tokens from the title.【F:Pages/Dashboard/Index.cshtml.cs†L18-L92】【F:Helpers/TodoQuickParser.cs†L8-L57】 Undo banners appear when completing or deleting items and can be re-opened within the page session.
- **Upcoming events** – Lists the next five calendar entries within 30 days, formatted in IST. All users can click through to the full calendar; editors can jump straight into the event drawer.【F:Pages/Dashboard/Index.cshtml.cs†L60-L87】

## 3. Tasks hub

Navigate to **Tasks** for the full task board.

- **Tabs & filters** – `Tab` query string selects _All_, _Today_, _Upcoming_, or _Completed_ while search (`?q=...`) performs case-insensitive title matches using PostgreSQL `ILIKE`. Pagination keeps 50 items per page.【F:Pages/Tasks/Index.cshtml.cs†L32-L85】
- **Grouping** – Tasks are grouped client-side into Overdue/Today/Upcoming using Indian Standard Time to avoid timezone drift.【F:Pages/Tasks/Index.cshtml.cs†L86-L145】
- **Actions** – Inline checkboxes toggle completion, the overflow menu exposes pin, snooze (`today_pm`, `tom_am`, `next_mon`, `clear`), edit, and delete commands. Drag handles allow reordering open tasks; the server persists the new order and protects against mismatched IDs.【F:Pages/Tasks/Index.cshtml.cs†L146-L206】
- **Quick parser edge cases** – Tokens are case-insensitive and only consumed once per word. If the parser strips every token, the saved title is empty so the UI prompts for a meaningful description.【F:Helpers/TodoQuickParser.cs†L20-L52】

## 4. Calendar workspace

Open **Calendar** for shared scheduling.

- **Views** – Month, week, and list modes with category pills for Visit/Insp/Conference/Other. Filtering happens client-side so switching categories is instant.【F:wwwroot/js/calendar.js†L1-L80】
- **Editing rights** – Admin, HoD, and TA roles can create, drag, resize, or delete events via the FullCalendar UI and minimal APIs. Everyone else sees read-only drawers with Markdown-rendered descriptions.【F:Pages/Calendar/Index.cshtml.cs†L11-L18】【F:Program.cs†L360-L498】
- **Recurrence** – Weekly and monthly recurrence rules are generated by the page script; the API clamps ranges greater than 400 days to prevent runaway queries.【F:wwwroot/js/calendar.js†L37-L120】【F:Program.cs†L361-L400】
- **Undo** – Moving or deleting an event triggers a toast with an Undo button that replays the previous payload through the API.【F:wwwroot/js/calendar.js†L89-L150】
- **Access control** – Minimal APIs require authentication, check roles on mutating verbs, and return `403` when unauthorized. Deleted events remain soft-deleted until an admin restores them under **Admin → Calendar → Deleted**.【F:Program.cs†L360-L498】

## 5. Celebrations registry

**Celebrations** keeps birthdays and anniversaries visible to the team.

- **Filtering** – Filter pills (`all`, `birthday`, `anniversary`) and window presets (`today`, `7`, `15`, `30`, `all`) trim the list. Search spans names and spouse names for joint entries.【F:Pages/Celebrations/Index.cshtml.cs†L22-L48】
- **Next occurrence** – Dates are calculated in IST with leap-day handling (Feb 29 shifts to Feb 28 on non-leap years). Each row shows days away to help plan logistics.【F:Pages/Celebrations/Index.cshtml.cs†L49-L70】【F:Helpers/CelebrationHelpers.cs†L10-L33】
- **Permissions** – Admin and TA roles can soft-delete entries; everyone else has read-only access.【F:Pages/Celebrations/Index.cshtml.cs†L19-L22】

## 6. Projects workspace

Projects consolidate procurement, planning, documents, comments, and photos.

- **Overview page** – Loads project details, category breadcrumbs, procurement facts, timeline status, plan editor state, and assignment lists in a single round trip. Off-canvas panels reuse this data for edits.【F:Pages/Projects/Overview.cshtml.cs†L59-L140】
- **Role assignments** – Admins and HoDs can change the HoD/PO pairing with optimistic concurrency; audit entries capture before/after values.【F:Pages/Projects/AssignRoles.cshtml.cs†L16-L116】
- **Procurement facts** – Captured via `ProjectFactsService`, which enforces stage backfill rules and writes structured audits. Updates immediately reflect on the overview tiles.【F:Services/Projects/ProjectFactsService.cs†L27-L200】
- **Timeline planning** – POs draft plans while HoDs approve or reject. Drafts are locked while pending approval and snapshots are stored for history. See [docs/timeline.md](../timeline.md) for detailed state transitions.【F:Services/Stages/PlanReadService.cs†L41-L212】【F:Services/Stages/PlanApprovalService.cs†L17-L200】
- **Comments & photos** – Threaded comments support attachments and mentions with storage handled by `ProjectCommentService`. Photo management enforces size/MIME rules and generates derivatives on upload.【F:Services/ProjectCommentService.cs†L22-L238】【F:Services/Projects/ProjectPhotoService.cs†L82-L420】

For a step-by-step storyboard, refer to [docs/projects-module.md](../projects-module.md).

## 7. Notifications

Click the bell icon or visit **Notifications** to manage alerts.

- **List view** – The page fetches the latest notifications, groups project IDs into filter options, and displays unread counts. Soft mutes per project and mark read/unread actions call the REST API and update the SignalR hub so other sessions stay in sync.【F:Pages/Notifications/Index.cshtml.cs†L17-L70】【F:Services/Notifications/UserNotificationService.cs†L23-L220】
- **Real-time updates** – The `NotificationDispatcher` hosted service processes dispatch queues and broadcasts new notifications over `/hubs/notifications`, respecting per-user preferences and project access.【F:Services/Notifications/NotificationDispatcher.cs†L20-L200】【F:Services/Notifications/NotificationPreferenceService.cs†L19-L160】
- **Retention** – Notifications older than the configured retention window (default 30 days) or beyond the per-user cap are pruned automatically.【F:appsettings.json†L32-L37】【F:Services/Notifications/NotificationRetentionService.cs†L20-L147】

## 8. Admin centre

Administrators manage governance tasks under the **Admin** area.

- **Users** – Search, filter by role or status, export CSV, and trigger lifecycle actions (enable/disable, reset password). Service guards block operations that would leave zero active admins.【F:Areas/Admin/Pages/Users/Index.cshtml.cs†L14-L87】【F:Services/UserLifecycleService.cs†L13-L150】
- **Analytics** – Login scatter chart and odd-hour report are generated by `LoginAnalyticsService`, with nightly aggregation handled by `LoginAggregationWorker`. Use the filters to adjust time range and role focus.【F:Services/LoginAnalyticsService.cs†L19-L200】【F:Services/LoginAggregationWorker.cs†L13-L110】
- **Categories & lookups** – Project category tree editing, lookup management, and document catalogue live under Admin → Categories/Lookups. Changes write to the audit log so historical context is preserved.【F:Areas/Admin/Pages/Categories/Edit.cshtml.cs†L15-L120】【F:Services/AuditService.cs†L16-L120】
- **Calendar recycle bin** – Restore accidentally deleted events from **Admin → Calendar → Deleted**; the list pulls from `Events` flagged with `IsDeleted = true`.【F:Areas/Admin/Pages/Calendar/Deleted.cshtml.cs†L13-L104】

## 9. Process designer & holidays

- **Process** – The Process page shows the current stage template version and last updated timestamp. HoD and MCO roles can launch the checklist editor via the REST API; others consume the published flow for reference.【F:Pages/Process/Index.cshtml.cs†L15-L64】
- **Holidays** – Admin and HoD roles manage the shared holiday list that feeds into scheduling engines and task snooze presets. Entries are stored as `DateOnly` values in `Models/Scheduling/Holiday`.【F:Pages/Settings/Holidays/Index.cshtml.cs†L13-L25】【F:Models/Scheduling/Holiday.cs†L1-L8】

## 10. Keeping data safe

- **Uploads** – All photos and documents land beneath the upload root resolved by `UploadRootProvider`. Configure `PM_UPLOAD_ROOT` to move storage off the web root in production.【F:Services/Storage/UploadRootProvider.cs†L17-L100】
- **Audit trail** – `AuditService` records create/update/delete events for tasks, projects, documents, and user lifecycle operations. Review logs under Admin → Logs when investigating issues.【F:Services/AuditService.cs†L16-L120】
- **Background workers** – Purge workers clean up stale todo items and deleted accounts based on the `Todo:RetentionDays` and `UserLifecycle` settings. Monitor logs for warnings that indicate stalled jobs.【F:Services/TodoPurgeWorker.cs†L14-L108】【F:Services/UserPurgeWorker.cs†L18-L120】

Use this guide in tandem with the technical documentation to onboard new teammates and to sanity-check behaviours before rolling out changes.
