@page
@model ProjectManagement.Pages.IndexModel
@using Microsoft.AspNetCore.Identity
@using ProjectManagement.Configuration
@inject SignInManager<ProjectManagement.Models.ApplicationUser> SignInManager

<section class="hero container-xxl">
  <div class="hero-left">
    @* === Hero intro === *@
    <h1 class="display-4 fw-bold mb-2">Plan. Track. Deliver.</h1>
    <p class="lead text-muted mb-3 pm-hero__subtitle">
      Project management for defence R&D. Track milestones, approvals and progress by role.
    </p>

    <div class="pm-hero__brandline">
      <img src="~/img/logos/artrac.png" asp-append-version="true"
           alt="Parent organisation crest" class="pm-hero__brandlogo" />
      <img src="~/img/logos/sdd.png" asp-append-version="true"
           alt="Company logo" class="pm-hero__brandlogo pm-hero__brandlogo--company" />
      <span class="pm-hero__brandtext">Built by Simulator Development Division</span>
    </div>

    <ul class="list-unstyled mb-4">
      <li class="mb-2">✦ Custom dashboards per role</li>
      <li class="mb-2">✦ Tasks, comments, and file attachments</li>
      <li class="mb-2">✦ Progress boards and timelines</li>
    </ul>

    @if (SignInManager.IsSignedIn(User))
    {
      <a class="btn btn-success btn-lg" asp-page="/Dashboard/Index">Go to your dashboard</a>
    }
    else
    {
      <a class="btn btn-primary btn-lg me-2" href="#login-card">Sign in</a>
      <a class="link-primary" href="#features">Explore features</a>
    }
  </div>

  <aside class="hero-right">
    @* <img class="hero-art" src="~/img/sdd.webp" alt="Eklavya sybolising self learning" /> *@
    @* === Hero quick actions / auth card === *@
    @if (SignInManager.IsSignedIn(User))
    {
      <div class="pm-hero-panel">
        <div class="pm-hero-panel__title">Welcome back</div>
        <div class="pm-hero-panel__text text-muted">Jump straight into ongoing work.</div>

        <div class="pm-hero-panel__actions-list">
          <a class="pm-action" asp-page="/Dashboard/Index">
            <i class="bi bi-speedometer2"></i>
            <span>Open dashboard</span>
            <i class="bi bi-chevron-right ms-auto"></i>
          </a>

          @if (User.IsInRole(RoleNames.Admin) || User.IsInRole(RoleNames.HoD))
          {
            <a class="pm-action" asp-page="/Projects/Create">
              <i class="bi bi-plus-circle"></i>
              <span>Create project</span>
              <i class="bi bi-chevron-right ms-auto"></i>
            </a>
          }

          @if (User.IsInRole(RoleNames.ProjectOffice) || User.IsInRole(RoleNames.Admin))
          {
            <a class="pm-action" asp-area="DocumentRepository" asp-page="/Documents/Upload">
              <i class="bi bi-upload"></i>
              <span>Upload document</span>
              <i class="bi bi-chevron-right ms-auto"></i>
            </a>
          }
        </div>
      </div>
    }
    else
    {
      <div class="hero-card" id="login-card">
        <partial name="_LoginCard" />
      </div>
    }
  </aside>
</section>

<section class="container-xxl pm-section pm-section--soft">
    <div class="row g-4 align-items-center">
        <div class="col-12 col-lg-6">
            <h2 class="pm-section__title">How work flows through the system</h2>
            <p class="text-muted mb-3">
                A single source of truth that links timelines, approvals, data, and documents.
            </p>
            <ol class="pm-flow">
                <li><strong>Create or update projects</strong> with stage plans, responsibilities, and PDCs.</li>
                <li><strong>Capture progress</strong> via reports and trackers used by Project Office.</li>
                <li><strong>Attach documents</strong> to projects or the repository and let OCR index them.</li>
                <li><strong>Search globally</strong> with ranked results spanning every module.</li>
            </ol>

            @if (!signedIn)
            {
                <a class="btn btn-primary mt-2" href="#login-card">Sign in to begin</a>
            }
        </div>

        <div class="col-12 col-lg-6">
            @* Keep your existing feature grid, now in a better shell *@
            <div class="pm-features-shell">
                <partial name="_FeatureGrid" />
            </div>
        </div>
    </div>
</section>

<section class="container-xxl pm-section">
    <div class="pm-section__header">
        <h2 class="pm-section__title">Operational advantages</h2>
        <p class="pm-section__subtitle text-muted">
            Designed for air-gapped environments and real defence documentation.
        </p>
    </div>

    <div class="row g-3 g-lg-4">
        <div class="col-12 col-md-4">
            <div class="pm-adv-card">
                <div class="pm-adv-card__title">Faster decisions</div>
                <div class="pm-adv-card__text text-muted">
                    Live dashboards show stage health, slippages, and completion signals.
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="pm-adv-card">
                <div class="pm-adv-card__title">Searchable institutional memory</div>
                <div class="pm-adv-card__text text-muted">
                    OCR + FTS makes even scanned PDFs discoverable across years.
                </div>
            </div>
        </div>
        <div class="col-12 col-md-4">
            <div class="pm-adv-card">
                <div class="pm-adv-card__title">Audit and compliance</div>
                <div class="pm-adv-card__text text-muted">
                    Traceable changes, role gates, and structured records for every action.
                </div>
            </div>
        </div>
    </div>
</section>

<section class="pm-section container-xxl">
    <partial name="_HowItWorks" />
</section>

<section id="security" class="pm-section container-xxl">
    <partial name="_SecurityStrip" />
</section>

@section Scripts {
    <script type="module" src="~/js/utils/password-toggle.js"></script>
    <script type="module" src="~/js/utils/login-card.js"></script>
}
