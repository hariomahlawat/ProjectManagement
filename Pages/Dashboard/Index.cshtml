@page
@model ProjectManagement.Pages.Dashboard.IndexModel
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using ProjectManagement.Services
@using ProjectManagement.Models
@{
    ViewData["Title"] = "Dashboard";
}

@if (TempData["Error"] is string err && !string.IsNullOrWhiteSpace(err))
{
  <div class="alert alert-warning py-2"><i class="bi bi-exclamation-triangle-fill me-2"></i>@err</div>
}

@if (Model.TodoWidget != null && (Model.TodoWidget.OverdueCount > 0 || Model.TodoWidget.DueTodayCount > 0))
{
  <div class="alert alert-warning d-flex align-items-center py-2" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <div class="small">
      You have
      @if (Model.TodoWidget.OverdueCount > 0)
      {
        <strong>@Model.TodoWidget.OverdueCount overdue</strong>
      }
      @if (Model.TodoWidget.OverdueCount > 0 && Model.TodoWidget.DueTodayCount > 0)
      {
        @:and
      }
      @if (Model.TodoWidget.DueTodayCount > 0)
      {
        <strong>@Model.TodoWidget.DueTodayCount due today</strong>
      }
      tasks. <a asp-page="/Tasks/Index" class="ms-1">Review</a>
    </div>
  </div>
}

<div class="row g-3 dashboard">
  <div class="col-lg-8">
    <h2 class="h5 fw-semibold mb-2">Dashboard</h2>
    <p class="text-secondary">This is a placeholder. Add role-specific widgets here.</p>
  </div>
  <div class="col-lg-4">
    <partial name="_TodoWidget" model="Model.TodoWidget" />
    <partial name="_CelebrationsWidget" />
    <partial name="_CalendarWidget" />
  </div>
</div>
