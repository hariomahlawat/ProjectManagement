@page
@model ProjectManagement.Pages.Process.IndexModel
@using System.Text.Json
@{
    ViewData["Title"] = "Procurement Process & Checklist";
    var graphJson = JsonSerializer.Serialize(Model.Flow, new JsonSerializerOptions(JsonSerializerDefaults.Web));
}

@section Styles {
    <link rel="stylesheet" href="~/css/process-diagram.css" asp-append-version="true" />
}

<div class="container-xxl">
    <h1 class="h3 mb-1">Procurement Process & Checklist</h1>
    <p class="text-muted mb-3">Explore the stages and open each stageâ€™s checklist.</p>

    <div class="process-layout">
        <div
            id="proc-diagram"
            class="proc-diagram"
            data-graph='@Html.Raw(graphJson)'>
        </div>

        <aside class="proc-panel">
            <div class="card sticky-top">
                <div class="card-body">
                    <h2 class="h6 mb-2" id="proc-stage-title">Select a stage</h2>
                    <p class="text-muted mb-2" id="proc-stage-sub">Click a node to view its checklist.</p>
                    <div class="small text-muted mb-3" id="proc-stage-meta"></div>

                    <div id="proc-checklist" data-can-edit="@(Model.Flow.CanEdit ? "1" : "0")">
                        <div class="text-muted">No stage selected.</div>
                    </div>

                    @if (Model.Flow.CanEdit)
                    {
                        <button type="button" id="proc-checklist-add" class="btn btn-sm btn-primary mt-3" disabled>Add checklist item</button>
                    }
                </div>
            </div>
        </aside>
    </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="checklistCanvas" aria-labelledby="checklistCanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="checklistCanvasLabel">Checklist editor</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body" id="checklistCanvasBody"></div>
</div>

@section Scripts {
    <script src="~/lib/elkjs/elk.bundled.js"></script>
    <script src="~/js/process-diagram.js" asp-append-version="true"></script>
}
