@page "/Projects/{id:int}/Photos"
@model ProjectManagement.Pages.Projects.Photos.IndexModel
@{
    ViewData["Title"] = $"Photos – {Model.Project.Name}";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="mb-0">Project Photos</h1>
        <p class="text-muted mb-0">Manage the images for this project.</p>
    </div>
    <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary"
           asp-page="./Reorder"
           asp-route-id="@Model.Project.Id"
           aria-label="Reorder photos for @Model.Project.Name">Reorder</a>
        <a class="btn btn-primary" asp-page="./Upload" asp-route-id="@Model.Project.Id">Upload Photo</a>
    </div>
</div>

@if (!Model.Photos.Any())
{
    <div class="alert alert-info">No photos have been uploaded for this project yet.</div>
}
else
{
    <div class="table-responsive">
        <table class="table align-middle">
            <thead>
                <tr>
                    <th scope="col">Preview</th>
                    <th scope="col">Caption</th>
                    <th scope="col">Ordinal</th>
                    <th scope="col">Cover</th>
                    <th scope="col" class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var photo in Model.Photos)
            {
                var accessibleDescription = !string.IsNullOrWhiteSpace(photo.Caption)
                    ? $"photo titled {photo.Caption}"
                    : $"photo in position {photo.Ordinal}";
                <tr>
                    <td style="width: 140px;">
                        @{ 
                            var previewSm = Url.Page("./View", new { id = Model.Project.Id, photoId = photo.Id, size = "sm" });
                            var previewMd = Url.Page("./View", new { id = Model.Project.Id, photoId = photo.Id, size = "md" });
                            var previewSrcSet = string.Join(", ", new[]
                            {
                                $"{previewSm} 1x",
                                $"{previewMd} 2x"
                            });
                        }
                        <picture>
                            <source type="image/webp" srcset="@previewSrcSet" />
                            <img src="@previewSm"
                                 srcset="@previewSrcSet"
                                 alt="Project photo preview"
                                 class="img-thumbnail"
                                 style="max-width: 128px;" />
                        </picture>
                    </td>
                    <td>
                        @if (!string.IsNullOrWhiteSpace(photo.Caption))
                        {
                            <div>@photo.Caption</div>
                        }
                        else
                        {
                            <span class="text-muted">No caption</span>
                        }
                    </td>
                    <td>@photo.Ordinal</td>
                    <td>
                        @if (photo.IsCover)
                        {
                            <span class="badge bg-success">Cover</span>
                        }
                        else
                        {
                            <span class="text-muted">—</span>
                        }
                    </td>
                    <td class="text-end">
                        <a class="btn btn-sm btn-outline-primary" asp-page="./Edit" asp-route-id="@Model.Project.Id" asp-route-photoId="@photo.Id">Edit</a>
                        <form method="post" asp-page-handler="Remove" class="d-inline">
                            <input type="hidden" name="photoId" value="@photo.Id" />
                            <input type="hidden" name="rowVersion" value="@Model.ProjectRowVersion" />
                            <button type="submit"
                                    class="btn btn-sm btn-outline-danger"
                                    data-confirm="Are you sure you want to remove this photo?"
                                    aria-label="Remove @accessibleDescription from @Model.Project.Name">Remove</button>
                        </form>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}

<div class="mt-4">
    <a asp-page="/Projects/Overview" asp-route-id="@Model.Project.Id" class="btn btn-link">Back to project overview</a>
</div>
