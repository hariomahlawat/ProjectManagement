@page "{id:int}"
@model ProjectManagement.Pages.Projects.Meta.EditModel
@{
    ViewData["Title"] = "Edit Project Details";
}

<h1 class="mb-4">Edit Project Details</h1>

<form method="post">
    <input asp-for="Input.ProjectId" type="hidden" />
    <input asp-for="Input.RowVersion" type="hidden" />
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
    <div class="mb-3">
        <label asp-for="Input.Name" class="form-label"></label>
        <input asp-for="Input.Name" class="form-control" />
        <span asp-validation-for="Input.Name" class="text-danger"></span>
    </div>
    @* SECTION: WYSIWYG markdown description editor *@
    <div class="mb-3 pm-desc-editor">
        <label asp-for="Input.Description" class="form-label"></label>
        <div id="pmDescEditor" data-pm-desc-editor data-initial-markdown="@Model.Input.Description"></div>
        <textarea asp-for="Input.Description" class="form-control d-none" maxlength="1000" data-pm-desc-hidden></textarea>
        <div class="form-text" data-char-count-for="Input_Description">0/1000</div>
        <div class="form-text text-danger d-none" data-pm-desc-limit-message>Character limit reached (1000).</div>
        <div class="form-text text-muted">
            Use the toolbar for formatting. Links are allowed (http/https/mailto). Raw HTML is not allowed.
        </div>
        <span asp-validation-for="Input.Description" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.CategoryId" class="form-label">Category</label>
        <select asp-for="Input.CategoryId" class="form-select" asp-items="Model.CategoryOptions"></select>
        <span asp-validation-for="Input.CategoryId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.TechnicalCategoryId" class="form-label">Technical Category</label>
        <select asp-for="Input.TechnicalCategoryId" class="form-select" asp-items="Model.TechnicalCategoryOptions"></select>
        <span asp-validation-for="Input.TechnicalCategoryId" class="text-danger"></span>
    </div>
    @* SECTION: Project type and build flag *@
    <div class="mb-3">
        <label asp-for="Input.ProjectTypeId" class="form-label">Project type</label>
        <select asp-for="Input.ProjectTypeId" class="form-select" asp-items="Model.ProjectTypeOptions"></select>
        <span asp-validation-for="Input.ProjectTypeId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" asp-for="Input.IsBuild" />
            <label class="form-check-label" asp-for="Input.IsBuild">Build (repeat / re-manufacture)</label>
        </div>
    </div>
    <div class="mb-3">
        <label asp-for="Input.SponsoringUnitId" class="form-label">Sponsoring Unit</label>
        <select asp-for="Input.SponsoringUnitId" class="form-select js-async-select" asp-items="Model.SponsoringUnitOptions" data-source="/api/lookups/sponsoring-units" data-search-placeholder="Search sponsoring units"></select>
        <span asp-validation-for="Input.SponsoringUnitId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.SponsoringLineDirectorateId" class="form-label">Sponsoring Line Dte</label>
        <select asp-for="Input.SponsoringLineDirectorateId" class="form-select js-async-select" asp-items="Model.LineDirectorateOptions" data-source="/api/lookups/line-directorates" data-search-placeholder="Search line directorates"></select>
        <span asp-validation-for="Input.SponsoringLineDirectorateId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.CaseFileNumber" class="form-label"></label>
        <input asp-for="Input.CaseFileNumber" class="form-control" />
        <span asp-validation-for="Input.CaseFileNumber" class="text-danger"></span>
    </div>
    @* SECTION: Legacy cost fields *@
    @if (Model.IsLegacyProject)
    {
        <div class="mb-3">
            <label asp-for="Input.RdCostLakhs" class="form-label">R&amp;D / L1 cost (lakh)</label>
            <input asp-for="Input.RdCostLakhs" class="form-control" type="number" step="0.01" inputmode="decimal" />
            <span asp-validation-for="Input.RdCostLakhs" class="text-danger"></span>
        </div>
        <div class="mb-3">
            <label asp-for="Input.ApproxProductionCost" class="form-label">Approx Prod cost (lakh)</label>
            <input asp-for="Input.ApproxProductionCost" class="form-control" type="number" step="0.01" inputmode="decimal" />
            <span asp-validation-for="Input.ApproxProductionCost" class="text-danger"></span>
        </div>
    }
    <button type="submit" class="btn btn-primary">Save changes</button>
</form>

@section Styles {
    <link rel="stylesheet" href="~/lib/toastui-editor/toastui-editor.min.css" asp-append-version="true" />
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/widgets/async-select.js" asp-append-version="true" defer></script>
    <script src="~/lib/toastui-editor/toastui-editor.min.js" asp-append-version="true" defer></script>
    <script src="~/js/pages/projects-meta-edit-description-wysiwyg.js" asp-append-version="true" defer></script>
}
