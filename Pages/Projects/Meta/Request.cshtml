@page "{id:int}"
@model ProjectManagement.Pages.Projects.Meta.RequestModel
@{
    ViewData["Title"] = "Request Project Change";
}

<h1 class="mb-4">Request change for @Model.ProjectName</h1>
<p class="text-muted">Submit updates for Head of Department approval. Fields left blank will keep their current values.</p>

<form method="post" class="mt-4">
    <input asp-for="Input.ProjectId" type="hidden" />
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
    <div class="mb-3">
        <label asp-for="Input.Name" class="form-label"></label>
        <input asp-for="Input.Name" class="form-control" />
        <span asp-validation-for="Input.Name" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.Description" class="form-label"></label>
        <textarea asp-for="Input.Description" rows="4" class="form-control"></textarea>
        <span asp-validation-for="Input.Description" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.CategoryId" class="form-label">Category</label>
        <select asp-for="Input.CategoryId" class="form-select" asp-items="Model.CategoryOptions"></select>
        <span asp-validation-for="Input.CategoryId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.TechnicalCategoryId" class="form-label">Technical Category</label>
        <select asp-for="Input.TechnicalCategoryId" class="form-select" asp-items="Model.TechnicalCategoryOptions"></select>
        <span asp-validation-for="Input.TechnicalCategoryId" class="text-danger"></span>
    </div>
    @* SECTION: Project type and build flag *@
    <div class="mb-3">
        <label asp-for="Input.ProjectTypeId" class="form-label">Project type</label>
        <select asp-for="Input.ProjectTypeId" class="form-select" asp-items="Model.ProjectTypeOptions"></select>
        <div class="form-text">Current: @Model.CurrentProjectType</div>
        <span asp-validation-for="Input.ProjectTypeId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.IsBuild" class="form-label">Build (repeat / re-manufacture)</label>
        <select asp-for="Input.IsBuild" class="form-select">
            <option value="">Keep current (@Model.CurrentBuildFlag)</option>
            <option value="true">Yes</option>
            <option value="false">No</option>
        </select>
        <span asp-validation-for="Input.IsBuild" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.SponsoringUnitId" class="form-label">Sponsoring Unit</label>
        <select asp-for="Input.SponsoringUnitId" class="form-select js-async-select" asp-items="Model.SponsoringUnitOptions" data-source="/api/lookups/sponsoring-units" data-search-placeholder="Search sponsoring units"></select>
        <span asp-validation-for="Input.SponsoringUnitId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.SponsoringLineDirectorateId" class="form-label">Sponsoring Line Dte</label>
        <select asp-for="Input.SponsoringLineDirectorateId" class="form-select js-async-select" asp-items="Model.LineDirectorateOptions" data-source="/api/lookups/line-directorates" data-search-placeholder="Search line directorates"></select>
        <span asp-validation-for="Input.SponsoringLineDirectorateId" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Input.CaseFileNumber" class="form-label"></label>
        <input asp-for="Input.CaseFileNumber" class="form-control" />
        <span asp-validation-for="Input.CaseFileNumber" class="text-danger"></span>
    </div>
    <div class="mb-4">
        <label asp-for="Input.Reason" class="form-label"></label>
        <textarea asp-for="Input.Reason" rows="3" class="form-control"></textarea>
        <span asp-validation-for="Input.Reason" class="text-danger"></span>
    </div>
    <button type="submit" class="btn btn-primary">Send request</button>
    <a asp-page="/Projects/Overview" asp-route-id="@Model.Input.ProjectId" class="btn btn-link">Cancel</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/widgets/async-select.js" asp-append-version="true" defer></script>
}
