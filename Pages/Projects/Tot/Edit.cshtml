@page "{id:int}"
@using Microsoft.AspNetCore.Mvc.ViewFeatures
@using ProjectManagement.Models
@using ProjectManagement.ViewModels
@model ProjectManagement.Pages.Projects.Tot.EditModel
@{
    var projectName = Model.Project?.Name ?? "Project";
    ViewData["Title"] = $"Transfer of Technology Â· {projectName}";
}

<div class="container-xxl py-4">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-page="/Projects/Index">Projects</a></li>
            <li class="breadcrumb-item"><a asp-page="/Projects/Overview" asp-route-id="@Model.Project?.Id">@projectName</a></li>
            <li class="breadcrumb-item active" aria-current="page">Transfer of Technology</li>
        </ol>
    </nav>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card pm-card">
                <div class="card-header pm-card-header">
                    <div class="pm-card-heading">
                        <span class="pm-card-icon" aria-hidden="true">
                            <i class="bi bi-diagram-3"></i>
                        </span>
                        <div>
                            <h1 class="pm-card-title h5 mb-0">Update Transfer of Technology</h1>
                            <p class="pm-card-subtitle mb-0">Track ToT status and milestones.</p>
                        </div>
                    </div>
                </div>
                <div class="card-body pm-card-body">
                    <form method="post" class="d-flex flex-column gap-3">
                        @Html.AntiForgeryToken()
                        <input asp-for="Input.ProjectId" type="hidden" />
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        @{
                            var totFormViewData = new ViewDataDictionary(ViewData)
                            {
                                [TotFormFieldsViewDataKeys.StatusOptions] = Model.StatusOptions,
                                [TotFormFieldsViewDataKeys.StatusLabel] = "Current status",
                                [TotFormFieldsViewDataKeys.ShowMilestoneHelp] = true
                            };
                        }
                        <partial name="_TotFormFields" model="Model.Input" view-data="totFormViewData" />

                        <div class="d-flex flex-wrap gap-2">
                            <button type="submit" class="btn btn-primary">Save changes</button>
                            <a class="btn btn-outline-secondary" asp-page="/Projects/Overview" asp-route-id="@Model.Project?.Id">Cancel</a>
                        </div>
                        <p class="text-muted small mb-0">Need to add context? Share it as a ToT remark below so the whole team can follow along.</p>
                    </form>
                </div>
            </div>

            <div class="card pm-card mt-4">
                <div class="card-header pm-card-header">
                    <div class="pm-card-heading">
                        <span class="pm-card-icon" aria-hidden="true">
                            <i class="bi bi-chat-text"></i>
                        </span>
                        <div>
                            <h2 class="pm-card-title h6 mb-0">Transfer of Technology remarks</h2>
                            <p class="pm-card-subtitle mb-0">Post quick notes for this ToT scope.</p>
                        </div>
                    </div>
                </div>
                <div class="card-body pm-card-body">
                    @if (!string.IsNullOrEmpty(Model.RemarkStatus))
                    {
                        <div class="alert alert-success" role="status">@Model.RemarkStatus</div>
                    }
                    <form method="post" asp-page-handler="AddRemark" class="d-flex flex-column gap-3">
                        <input asp-for="RemarkInput.ProjectId" type="hidden" />
                        <div>
                            <label asp-for="RemarkInput.Body" class="form-label">Add a remark</label>
                            <textarea asp-for="RemarkInput.Body" class="form-control" rows="3"></textarea>
                            <div class="form-text">Remarks here are saved under Transfer of Technology.</div>
                            <span asp-validation-for="RemarkInput.Body" class="text-danger"></span>
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                            <button type="submit" class="btn btn-primary">Post remark</button>
                            <a class="btn btn-outline-secondary" asp-page="/Projects/Overview" asp-route-id="@Model.Project?.Id">Open remarks panel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card pm-card">
                <div class="card-header pm-card-header">
                    <div class="pm-card-heading">
                        <span class="pm-card-icon" aria-hidden="true">
                            <i class="bi bi-info-circle"></i>
                        </span>
                        <div>
                            <h2 class="pm-card-title h6 mb-0">Guidance</h2>
                            <p class="pm-card-subtitle mb-0">Date requirements by status.</p>
                        </div>
                    </div>
                </div>
                <div class="card-body pm-card-body">
                    <ul class="list-unstyled mb-0 small">
                        <li class="mb-2"><strong>Not required</strong>: Leave both dates empty.</li>
                        <li class="mb-2"><strong>Not started</strong>: Leave both dates empty until ToT begins.</li>
                        <li class="mb-2"><strong>In progress</strong>: Provide the start date; completion must stay empty.</li>
                        <li><strong>Completed</strong>: Provide both start and completion dates; completion cannot be earlier than the start.</li>
                        <li class="mt-2">Update MET and first production model milestones when available.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
