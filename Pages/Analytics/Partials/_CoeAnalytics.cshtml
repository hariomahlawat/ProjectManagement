@model ProjectManagement.Models.Analytics.CoeAnalyticsVm
@using System.Linq
@using System.Text.Json

@{
    // SECTION: JSON serialiser options
    var jsonOptions = new JsonSerializerOptions
    {
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
    };

    var shortTerm = Model.Roadmap.ShortTerm ?? Array.Empty<string>();
    var midTerm = Model.Roadmap.MidTerm ?? Array.Empty<string>();
    var longTerm = Model.Roadmap.LongTerm ?? Array.Empty<string>();
    var noCoeProjectsMessage = "No CoE projects to analyse yet. Create a CoE project to see analytics here.";
    var noSubcategoryMessage = "CoE sub-category breakdown will appear here once projects have sub-categories configured.";
    // END SECTION
}

<section class="analytics-panel analytics-panel--coe" aria-label="CoE projects analytics">
    <!-- SECTION: CoE analytics layout -->
    <div class="analytics-layout">
        <div class="analytics-grid analytics-grid--coe">
            <!-- Card 1: Ongoing CoE projects by current stage -->
            <article class="analytics-card">
                <header class="analytics-card__header">
                    <h2 class="analytics-card__title">Ongoing CoE projects by current stage</h2>
                    <p class="analytics-card__meta">
                        Current stage distribution for active CoE projects.
                    </p>
                </header>
                <div class="analytics-card__body">
                    @if (!Model.HasCoeProjects)
                    {
                        <p class="analytics-card__empty-text">@noCoeProjectsMessage</p>
                    }
                    else
                    {
                        <div class="analytics-card__chart">
                            <canvas id="coe-by-stage-chart"
                                    role="img"
                                    aria-label="Ongoing CoE projects by current stage"
                                    data-series='@Html.Raw(JsonSerializer.Serialize(Model.ByStage, jsonOptions))'>
                            </canvas>
                        </div>
                    }
                </div>
            </article>

            <!-- Card 3: CoE sub-categories vs lifecycle -->
            <article class="analytics-card analytics-card--wide">
                <header class="analytics-card__header">
                    <h2 class="analytics-card__title">CoE sub-categories by lifecycle</h2>
                    <p class="analytics-card__meta">
                        Distribution of CoE sub-categories across lifecycle statuses.
                    </p>
                </header>
                <div class="analytics-card__body">
                    @if (!Model.HasSubcategoryBreakdown)
                    {
                        <p class="analytics-card__empty-text">@noSubcategoryMessage</p>
                    }
                    else
                    {
                        <div class="analytics-card__chart analytics-card__chart--scrollable">
                            <canvas id="coe-subcategories-by-lifecycle-chart"
                                    role="img"
                                    aria-label="CoE sub-categories by lifecycle status"
                                    data-series='@Html.Raw(JsonSerializer.Serialize(Model.SubcategoriesByLifecycle, jsonOptions))'>
                            </canvas>
                        </div>
                        <p class="analytics-card__footnote">Only CoE sub-categories with at least one project are shown.</p>
                    }
                </div>
            </article>
        </div>

        <!-- CoE roadmap summary -->
        <section class="analytics-roadmap" aria-label="CoE roadmap summary">
            <div class="analytics-roadmap__column">
                <h3 class="analytics-roadmap__heading">Short term</h3>
                <ul class="analytics-roadmap__list">
                    @if (shortTerm.Any())
                    {
                        foreach (var item in shortTerm)
                        {
                            <li class="analytics-roadmap__item">@item</li>
                        }
                    }
                    else
                    {
                        <li class="analytics-roadmap__item analytics-roadmap__item--muted">No short-term initiatives yet.</li>
                    }
                </ul>
            </div>

            <div class="analytics-roadmap__column">
                <h3 class="analytics-roadmap__heading">Mid term</h3>
                <ul class="analytics-roadmap__list">
                    @if (midTerm.Any())
                    {
                        foreach (var item in midTerm)
                        {
                            <li class="analytics-roadmap__item">@item</li>
                        }
                    }
                    else
                    {
                        <li class="analytics-roadmap__item analytics-roadmap__item--muted">No mid-term initiatives yet.</li>
                    }
                </ul>
            </div>

            <div class="analytics-roadmap__column">
                <h3 class="analytics-roadmap__heading">Long term</h3>
                <ul class="analytics-roadmap__list">
                    @if (longTerm.Any())
                    {
                        foreach (var item in longTerm)
                        {
                            <li class="analytics-roadmap__item">@item</li>
                        }
                    }
                    else
                    {
                        <li class="analytics-roadmap__item analytics-roadmap__item--muted">No long-term initiatives yet.</li>
                    }
                </ul>
            </div>
        </section>
    </div>
    <!-- END SECTION -->
</section>
