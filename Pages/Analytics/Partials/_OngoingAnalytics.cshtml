@model ProjectManagement.Models.Analytics.OngoingAnalyticsVm
@using System.Text.Json

@{
    // SECTION: Ongoing analytics serialization
    var jsonOptions = new JsonSerializerOptions
    {
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
    };
    // END SECTION
}

<section class="analytics-panel analytics-panel--ongoing" aria-label="Ongoing projects analytics">
    <!-- SECTION: Ongoing analytics layout -->
    <div class="analytics-layout">
        <div class="analytics-grid analytics-grid--ongoing">

            <!-- Card: category distribution -->
            <article class="analytics-card">
                <header class="analytics-card__header">
                    <h2 class="analytics-card__title">Ongoing projects by category</h2>
                    <p class="analytics-card__meta">Breakdown of ongoing projects in each project category.</p>
                </header>
                <div class="analytics-card__body">
                    <div class="analytics-card__chart">
                        <canvas id="ongoing-by-category-chart"
                                aria-label="Ongoing projects by category"
                                role="img"
                                data-series='@Html.Raw(JsonSerializer.Serialize(Model.ByCategory, jsonOptions))'></canvas>
                    </div>
                </div>
            </article>

            <!-- Card: stage distribution -->
            <article class="analytics-card">
                <header class="analytics-card__header">
                    <div class="analytics-card__title-block">
                        <h2 class="analytics-card__title">Ongoing projects by current stage</h2>
                        <p class="analytics-card__meta">
                            How many ongoing projects are currently in each stage, split by category.
                        </p>
                    </div>
                    <!-- SECTION: Stage chart controls -->
                    <div class="analytics-chart-controls" data-chart-controls-for="ongoing-by-stage-chart">
                        <div class="analytics-chart-controls__group">
                            <label class="form-label analytics-chart-controls__label" for="ongoingStageCategoriesChips">
                                Categories
                            </label>
                            <div id="ongoingStageCategoriesChips"
                                 class="analytics-chip-picker"
                                 data-chart-category-chips
                                 aria-label="Category filter"></div>
                            <div class="analytics-chart-controls__hint text-muted"
                                 data-chart-category-hint
                                 hidden>
                                At least one category must remain selected.
                            </div>
                            <div class="analytics-chart-controls__actions">
                                <button type="button"
                                        class="btn btn-sm btn-outline-secondary"
                                        data-chart-select-all>
                                    Select all
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-outline-secondary"
                                        data-chart-clear
                                        title="Reset selection to all categories">
                                    Reset
                                </button>
                            </div>
                        </div>

                        <div class="analytics-chart-controls__toggles">
                            <div class="form-check form-switch analytics-chart-controls__toggle">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="ongoingStageShowLabels"
                                       data-chart-show-labels />
                                <label class="form-check-label" for="ongoingStageShowLabels">Show labels</label>
                            </div>

                            <button type="button"
                                    class="btn btn-sm btn-outline-primary"
                                    data-chart-download>
                                Download
                            </button>
                        </div>
                    </div>
                    <!-- END SECTION -->
                </header>
                <div class="analytics-card__body">
                    <div class="analytics-card__chart">
                        <canvas id="ongoing-by-stage-chart"
                                aria-label="Ongoing projects by current stage"
                                role="img"
                                data-series='@Html.Raw(JsonSerializer.Serialize(Model.ByStage, jsonOptions))'
                                data-series-by-category='@Html.Raw(JsonSerializer.Serialize(Model.ByStageByCategory, jsonOptions))'></canvas>
                    </div>
                </div>
            </article>

            <!-- Card: time-in-stage -->
            <article class="analytics-card analytics-card--wide">
                <header class="analytics-card__header">
                    <div class="analytics-card__title-block">
                        <h2 class="analytics-card__title">Average time spent in each stage</h2>
                        <p class="analytics-card__meta">
                            Average number of days ongoing projects spend in each stage, grouped by category.
                        </p>
                    </div>
                    <!-- SECTION: Stage duration chart controls -->
                    <div class="analytics-chart-controls" data-chart-controls-for="ongoing-stage-duration-chart">
                        <div class="analytics-chart-controls__group">
                            <label class="form-label analytics-chart-controls__label" for="ongoingDurationCategoriesChips">
                                Categories
                            </label>
                            <div id="ongoingDurationCategoriesChips"
                                 class="analytics-chip-picker"
                                 data-chart-category-chips
                                 aria-label="Category filter"></div>
                            <div class="analytics-chart-controls__hint text-muted"
                                 data-chart-category-hint
                                 hidden>
                                At least one category must remain selected.
                            </div>
                            <div class="analytics-chart-controls__actions">
                                <button type="button"
                                        class="btn btn-sm btn-outline-secondary"
                                        data-chart-select-all>
                                    Select all
                                </button>
                                <button type="button"
                                        class="btn btn-sm btn-outline-secondary"
                                        data-chart-clear
                                        title="Reset selection to all categories">
                                    Reset
                                </button>
                            </div>
                        </div>

                        <div class="analytics-chart-controls__toggles">
                            <div class="form-check form-switch analytics-chart-controls__toggle">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="ongoingDurationShowLabels"
                                       data-chart-show-labels />
                                <label class="form-check-label" for="ongoingDurationShowLabels">Show labels</label>
                            </div>

                            <button type="button"
                                    class="btn btn-sm btn-outline-primary"
                                    data-chart-download>
                                Download
                            </button>
                        </div>
                    </div>
                    <!-- END SECTION -->
                </header>
                <div class="analytics-card__body">
                    <div class="analytics-card__chart">
                        <canvas id="ongoing-stage-duration-chart"
                                aria-label="Average time spent in each stage"
                                role="img"
                                data-series='@Html.Raw(JsonSerializer.Serialize(Model.AvgStageDurations, jsonOptions))'
                                data-series-by-category='@Html.Raw(JsonSerializer.Serialize(Model.AvgStageDurationsByCategory, jsonOptions))'></canvas>
                    </div>
                </div>
            </article>

        </div>
    </div>
    <!-- END SECTION -->
</section>
