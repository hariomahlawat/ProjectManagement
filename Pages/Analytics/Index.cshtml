@page
@model ProjectManagement.Pages.Analytics.IndexModel
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using ProjectManagement.Models.Analytics
@using ProjectManagement.Pages.Analytics
@using ProjectManagement.Services.Projects
@{ 
    ViewData["Title"] = "Analytics";
    ViewData["UseFullWidth"] = true;
    var categories = Model.Categories ?? Array.Empty<ProjectManagement.Pages.Analytics.IndexModel.CategoryOption>();
    var technicalCategories = Model.TechnicalCategories ?? Array.Empty<ProjectManagement.Pages.Analytics.IndexModel.TechnicalCategoryOption>();
    ViewData["AnalyticsCategories"] = categories;
    ViewData["AnalyticsTechnicalCategories"] = technicalCategories;
}

@section Styles {
    <!-- SECTION: Analytics styles -->
    <link rel="stylesheet" href="~/css/analytics.css" asp-append-version="true" />
    <!-- END SECTION -->
}

@* <!-- SECTION: Analytics header -->
@await Html.PartialAsync("Partials/_AnalyticsHeader", Model)
<!-- END SECTION --> *@

<section class="analytics-page" data-analytics-tab="@Model.ActiveTab">
  <!-- Analytics layout: mode navigation and chart canvas -->
  <div
    id="analytics-root"
    data-default-lifecycle="@Model.DefaultLifecycle"
    data-projects-index-url="@Url.Page("/Projects/Index")"
    data-project-overview-url="@Url.Page("/Projects/Overview")"
  >
    <div class="analytics-layout" aria-label="Project analytics views">
      <aside class="analytics-left-rail" aria-label="Analytics modes">
        <!-- Left navigation for analytics modes -->
        <nav class="analytics-left-nav" aria-label="Analytics views">
          <a
            asp-page="./Index"
            asp-route-tab="Completed"
            class="analytics-left-nav__item @(Model.ActiveTab == AnalyticsTab.Completed ? "is-active" : null)"
          >
            <div class="analytics-left-nav__title">Completed projects</div>
            <div class="analytics-left-nav__meta">@Model.CompletedCount projects</div>
          </a>

          <a
            asp-page="./Index"
            asp-route-tab="Ongoing"
            class="analytics-left-nav__item @(Model.ActiveTab == AnalyticsTab.Ongoing ? "is-active" : null)"
          >
            <div class="analytics-left-nav__title">Ongoing projects</div>
            <div class="analytics-left-nav__meta">@Model.OngoingCount projects</div>
          </a>

          <a
            asp-page="./Index"
            asp-route-tab="Coe"
            class="analytics-left-nav__item @(Model.ActiveTab == AnalyticsTab.Coe ? "is-active" : null)"
          >
            <div class="analytics-left-nav__title">CoE projects</div>
            <div class="analytics-left-nav__meta">@Model.CoeCount projects</div>
          </a>
        </nav>
      </aside>

      <div class="analytics-main" data-role="analytics-main">
        <!-- SECTION: Analytics content panel -->
        <div class="analytics-main-panel">
          @switch (Model.ActiveTab)
          {
            case AnalyticsTab.Completed:
              @await Html.PartialAsync("Partials/_CompletedAnalytics", Model.Completed!)
              break;

            case AnalyticsTab.Ongoing:
              @await Html.PartialAsync("Partials/_OngoingAnalytics", Model.Ongoing!)
              break;

            case AnalyticsTab.Coe:
              @await Html.PartialAsync("Partials/_CoeAnalytics", Model.Coe!)
              break;
          }
        </div>
        <!-- END SECTION -->
      </div>
    </div>
  </div>
</section>

@section Scripts {
  <script src="~/lib/chart.js/chart.umd.js" asp-append-version="true"></script>
  <script type="module" src="~/js/analytics-projects.js" asp-append-version="true"></script>
}
