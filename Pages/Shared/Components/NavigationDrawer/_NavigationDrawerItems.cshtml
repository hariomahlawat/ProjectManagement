@model ProjectManagement.ViewComponents.NavigationDrawerItemsViewModel
@using ProjectManagement.ViewComponents

@{
    var listClasses = Model.Depth == 0
        ? "pm-drawer__list pm-drawer__list--root"
        : "pm-drawer__list pm-drawer__list--nested";
}

<ul class="@listClasses">
@foreach (var node in Model.Nodes)
{
    var itemClasses = "pm-drawer__item";
    if (Model.Depth == 0 && node.Children.Count > 0 && string.IsNullOrEmpty(node.Url))
    {
        itemClasses += " pm-drawer__item--section";
    }

    var baseClass = string.IsNullOrEmpty(node.Url)
        ? "pm-drawer__label"
        : "pm-drawer__link";
    var accentClass = string.IsNullOrEmpty(node.Accent)
        ? string.Empty
        : $" pm-drawer__accent--{node.Accent}";
    var displayClasses = baseClass + accentClass;
    var badgeName = node.BadgeViewComponentName;
    var badgeParameters = node.BadgeViewComponentParameters ?? new { };

    if (node.IsActive || node.HasActiveDescendant)
    {
        displayClasses += " is-active";
    }

    <li class="@itemClasses">
        @if (!string.IsNullOrEmpty(node.Url))
        {
            <a class="@displayClasses" href="@node.Url" @(node.IsActive ? "aria-current=\"page\"" : null)>
                <span class="pm-drawer__content">
                    @if (!string.IsNullOrEmpty(node.Icon))
                    {
                        <span class="pm-drawer__icon" aria-hidden="true">
                            <i class="bi @node.Icon"></i>
                        </span>
                    }
                    <span class="pm-drawer__text">@node.Text</span>
                </span>
                @if (!string.IsNullOrEmpty(badgeName))
                {
                    <span class="pm-drawer__meta">@await Component.InvokeAsync(badgeName!, badgeParameters)</span>
                }
            </a>
        }
        else
        {
            <span class="@displayClasses" @(node.IsActive ? "aria-current=\"page\"" : null)>
                <span class="pm-drawer__content">
                    @if (!string.IsNullOrEmpty(node.Icon))
                    {
                        <span class="pm-drawer__icon" aria-hidden="true">
                            <i class="bi @node.Icon"></i>
                        </span>
                    }
                    <span class="pm-drawer__text">@node.Text</span>
                </span>
                @if (!string.IsNullOrEmpty(badgeName))
                {
                    <span class="pm-drawer__meta">@await Component.InvokeAsync(badgeName!, badgeParameters)</span>
                }
            </span>
        }

        @if (node.Children.Count > 0)
        {
            @await Html.PartialAsync(
                "~/Pages/Shared/Components/NavigationDrawer/_NavigationDrawerItems.cshtml",
                Model with
            {
                Nodes = node.Children,
                Depth = Model.Depth + 1
            })
        }
    </li>
}
</ul>
