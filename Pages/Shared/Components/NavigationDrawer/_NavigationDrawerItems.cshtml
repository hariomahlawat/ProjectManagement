@model ProjectManagement.ViewComponents.NavigationDrawerItemsViewModel
@using ProjectManagement.ViewComponents

@{
    var listClasses = "pm-drawer__list";
}

<ul class="@listClasses">
@foreach (var node in Model.Nodes)
{
    var itemClasses = "pm-drawer__item";
    var displayClasses = string.IsNullOrEmpty(node.Url)
        ? "pm-drawer__label"
        : "pm-drawer__link";
    var badgeName = node.BadgeViewComponentName;
    var badgeParameters = node.BadgeViewComponentParameters ?? new { };

    if (node.IsActive || node.HasActiveDescendant)
    {
        displayClasses += " is-active";
    }

    <li class="@itemClasses">
        @if (!string.IsNullOrEmpty(node.Url))
        {
            <a class="@displayClasses" href="@node.Url" @(node.IsActive ? "aria-current=\"page\"" : null)>
                <span class="pm-drawer__text flex-grow-1">@node.Text</span>
                @if (!string.IsNullOrEmpty(badgeName))
                {
                    @await Component.InvokeAsync(badgeName!, badgeParameters)
                }
            </a>
        }
        else
        {
            <span class="@displayClasses" @(node.IsActive ? "aria-current=\"page\"" : null)>
                <span class="pm-drawer__text flex-grow-1">@node.Text</span>
                @if (!string.IsNullOrEmpty(badgeName))
                {
                    @await Component.InvokeAsync(badgeName!, badgeParameters)
                }
            </span>
        }

        @if (node.Children.Count > 0)
        {
            @await Html.PartialAsync(
                "~/Pages/Shared/Components/NavigationDrawer/_NavigationDrawerItems.cshtml",
                Model with
            {
                Nodes = node.Children,
                Depth = Model.Depth + 1
            })
        }
    </li>
}
</ul>
