@model ProjectManagement.Services.Projects.ProcurementAtAGlanceVm
@using System.Globalization
@{
    string ShortInr(decimal value)
    {
        var culture = CultureInfo.GetCultureInfo("en-IN");
        var abs = System.Math.Abs(value);

        if (abs >= 1_00_00_000m)
        {
            return $"₹ {(value / 1_00_00_000m).ToString("0.##", culture)} Cr";
        }

        if (abs >= 1_00_000m)
        {
            return $"₹ {(value / 1_00_000m).ToString("0.##", culture)} Lakh";
        }

        return value.ToString("C2", culture);
    }

    string Money(decimal? value) => value.HasValue ? ShortInr(value.Value) : "—";
    string FullInr(decimal? value) => value.HasValue ? value.Value.ToString("C2", CultureInfo.GetCultureInfo("en-IN")) : "—";
    string DateDmy(DateOnly? d) => d.HasValue ? d.Value.ToString("dd MMM yyyy", CultureInfo.CurrentCulture) : "—";
}

<div class="card pm-card">
  <div class="card-header pm-card-header">
    <div class="pm-card-heading">
      <span class="pm-card-icon" aria-hidden="true">
        <i class="bi bi-receipt"></i>
      </span>
      <div>
        <h2 class="pm-card-title h5 mb-0">Procurement at a glance</h2>
        <p class="pm-card-subtitle mb-0">Key budget markers for this project.</p>
      </div>
    </div>
    @if (User.IsInRole("Admin") || User.IsInRole("HoD") || User.IsInRole("Project Officer"))
    {
      <div class="pm-card-menu dropdown">
        <button type="button"
                class="btn pm-card-menu-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-label="Procurement actions">
          <i class="bi bi-three-dots-vertical" aria-hidden="true"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <button type="button"
                    class="dropdown-item d-flex align-items-center gap-2"
                    data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasProcurement"
                    aria-controls="offcanvasProcurement">
              <i class="bi bi-pencil-square" aria-hidden="true"></i>
              <span>Edit details</span>
            </button>
          </li>
        </ul>
      </div>
    }
  </div>

  <div class="card-body pm-card-body">
    <div class="procurement-metrics">
      <div>
        <span class="procurement-label text-muted">IPA Cost</span>
        <span class="procurement-value fw-semibold" title="@FullInr(Model.IpaCost)">@Money(Model.IpaCost)</span>
      </div>
      <div>
        <span class="procurement-label text-muted">AON Cost</span>
        <span class="procurement-value fw-semibold" title="@FullInr(Model.AonCost)">@Money(Model.AonCost)</span>
      </div>
      <div>
        <span class="procurement-label text-muted">Benchmark Cost</span>
        <span class="procurement-value fw-semibold" title="@FullInr(Model.BenchmarkCost)">@Money(Model.BenchmarkCost)</span>
      </div>
      <div>
        <span class="procurement-label text-muted">L1 Cost</span>
        <span class="procurement-value fw-semibold" title="@FullInr(Model.L1Cost)">@Money(Model.L1Cost)</span>
      </div>
      <div>
        <span class="procurement-label text-muted">PNC Cost</span>
        <span class="procurement-value fw-semibold" title="@FullInr(Model.PncCost)">@Money(Model.PncCost)</span>
      </div>
      <div>
        <span class="procurement-label text-muted">Supply Order Date</span>
        <span class="procurement-value fw-semibold">@DateDmy(Model.SupplyOrderDate)</span>
      </div>
    </div>

    <div class="mt-2 small text-muted">
      Latest recorded values. Use the Edit Procurement panel to update these figures.
    </div>
  </div>
</div>
