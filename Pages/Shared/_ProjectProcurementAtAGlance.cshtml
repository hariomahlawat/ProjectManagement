@model ProjectManagement.Services.Projects.ProcurementAtAGlanceVm
@using System.Globalization
@{
    string ShortInr(decimal value)
    {
        var culture = CultureInfo.GetCultureInfo("en-IN");
        var abs = System.Math.Abs(value);
        var sign = value < 0 ? "−" : string.Empty;

        if (abs >= 1_00_00_000m)
        {
            return $"{sign}{(abs / 1_00_00_000m).ToString("0.##", culture)} Cr";
        }

        if (abs >= 1_00_000m)
        {
            return $"{sign}{(abs / 1_00_000m).ToString("0.##", culture)} Lakh";
        }

        return value.ToString("N2", culture);
    }

    string Money(decimal? value) => value.HasValue ? ShortInr(value.Value) : "—";
    string FullInr(decimal? value) => value.HasValue ? value.Value.ToString("C2", CultureInfo.GetCultureInfo("en-IN")) : "—";
    string DateDmy(DateOnly? d) => d.HasValue
        ? d.Value.ToString("dd MMM yyyy", CultureInfo.CurrentCulture).Replace(' ', '\u00A0')
        : "—";
}

<div class="card">
  <div class="card-header d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center">
      <i class="bi bi-receipt me-2" aria-hidden="true"></i>
      <span class="fw-semibold">Procurement At-a-Glance</span>
    </div>
    @if (User.IsInRole("Admin") || User.IsInRole("HoD") || User.IsInRole("Project Officer"))
    {
      <button class="btn btn-sm btn-outline-primary" data-bs-toggle="offcanvas" data-bs-target="#offcanvasProcurement" aria-controls="offcanvasProcurement">
        Edit Procurement
      </button>
    }
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-sm table-borderless align-middle mb-3">
        <thead>
          <tr>
            <th scope="col" class="text-muted text-uppercase small">Metric</th>
            <th scope="col" class="text-muted text-uppercase small text-end">₹</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row" class="text-muted">IPA Cost</th>
            <td class="text-end fw-semibold@(Model.IpaCost.HasValue ? string.Empty : " text-muted")"
                title="@(Model.IpaCost.HasValue ? FullInr(Model.IpaCost) : null)">@Money(Model.IpaCost)</td>
          </tr>
          <tr>
            <th scope="row" class="text-muted">AON Cost</th>
            <td class="text-end fw-semibold@(Model.AonCost.HasValue ? string.Empty : " text-muted")"
                title="@(Model.AonCost.HasValue ? FullInr(Model.AonCost) : null)">@Money(Model.AonCost)</td>
          </tr>
          <tr>
            <th scope="row" class="text-muted">Benchmark Cost</th>
            <td class="text-end fw-semibold@(Model.BenchmarkCost.HasValue ? string.Empty : " text-muted")"
                title="@(Model.BenchmarkCost.HasValue ? FullInr(Model.BenchmarkCost) : null)">@Money(Model.BenchmarkCost)</td>
          </tr>
          <tr>
            <th scope="row" class="text-muted">L1 Cost</th>
            <td class="text-end fw-semibold@(Model.L1Cost.HasValue ? string.Empty : " text-muted")"
                title="@(Model.L1Cost.HasValue ? FullInr(Model.L1Cost) : null)">@Money(Model.L1Cost)</td>
          </tr>
          <tr>
            <th scope="row" class="text-muted">PNC Cost</th>
            <td class="text-end fw-semibold@(Model.PncCost.HasValue ? string.Empty : " text-muted")"
                title="@(Model.PncCost.HasValue ? FullInr(Model.PncCost) : null)">@Money(Model.PncCost)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-baseline">
      <span class="text-muted">Supply Order Date</span>
      <span class="fw-semibold@(Model.SupplyOrderDate.HasValue ? string.Empty : " text-muted")">@DateDmy(Model.SupplyOrderDate)</span>
    </div>

    <div class="mt-2 small text-muted">
      Latest recorded values. Use the Edit Procurement panel to update these figures.
    </div>
  </div>
</div>
