@model ProjectManagement.Services.Projects.ProcurementAtAGlanceVm
@using System.Globalization
@{
    string ShortInr(decimal value)
    {
        var culture = CultureInfo.GetCultureInfo("en-IN");
        var abs = System.Math.Abs(value);

        if (abs >= 1_00_00_000m)
        {
            return $"₹ {(value / 1_00_00_000m).ToString("0.##", culture)} Cr";
        }

        if (abs >= 1_00_000m)
        {
            return $"₹ {(value / 1_00_000m).ToString("0.##", culture)} Lakh";
        }

        return value.ToString("C2", culture);
    }

    string Money(decimal? value) => value.HasValue ? ShortInr(value.Value) : "—";
    string FullInr(decimal? value) => value.HasValue ? value.Value.ToString("C2", CultureInfo.GetCultureInfo("en-IN")) : "—";
    string DateDmy(DateOnly? d) => d.HasValue ? d.Value.ToString("dd MMM yyyy", CultureInfo.CurrentCulture) : "—";
}

<div class="card">
  <div class="card-header">
    <div class="card-action-bar">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-receipt" aria-hidden="true"></i>
        <span class="fw-semibold">Procurement At-a-Glance</span>
      </div>
      @if (User.IsInRole("Admin") || User.IsInRole("HoD") || User.IsInRole("Project Officer"))
      {
        <div class="card-action-bar-actions">
          <button type="button"
                  class="btn btn-link card-action-link"
                  data-bs-toggle="offcanvas"
                  data-bs-target="#offcanvasProcurement"
                  aria-controls="offcanvasProcurement">
            <i class="bi bi-pencil-square" aria-hidden="true"></i>
            <span>Edit procurement</span>
          </button>
        </div>
      }
    </div>
  </div>

  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6">
        <div class="d-flex justify-content-between">
          <span class="text-muted">IPA Cost</span>
          <span class="fw-semibold" title="@FullInr(Model.IpaCost)">@Money(Model.IpaCost)</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">AON Cost</span>
          <span class="fw-semibold" title="@FullInr(Model.AonCost)">@Money(Model.AonCost)</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">Benchmark Cost</span>
          <span class="fw-semibold" title="@FullInr(Model.BenchmarkCost)">@Money(Model.BenchmarkCost)</span>
        </div>
      </div>

      <div class="col-md-6">
        <div class="d-flex justify-content-between">
          <span class="text-muted">L1 Cost</span>
          <span class="fw-semibold" title="@FullInr(Model.L1Cost)">@Money(Model.L1Cost)</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">PNC Cost</span>
          <span class="fw-semibold" title="@FullInr(Model.PncCost)">@Money(Model.PncCost)</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">Supply Order Date</span>
          <span class="fw-semibold">@DateDmy(Model.SupplyOrderDate)</span>
        </div>
      </div>
    </div>

    <div class="mt-2 small text-muted">
      Latest recorded values. Use the Edit Procurement panel to update these figures.
    </div>
  </div>
</div>
