@page
@model ProjectManagement.Pages.Calendar.IndexModel
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@{
    ViewData["Title"] = "Calendar";
}

@section Styles {
  <link rel="stylesheet" href="~/lib/fullcalendar/daygrid/index.min.css" />
  <link rel="stylesheet" href="~/lib/fullcalendar/timegrid/index.min.css" />
  <link rel="stylesheet" href="~/lib/fullcalendar/list/index.min.css" />
  <style>
    /* fixed-height wrapper so the calendar doesn't grow infinitely */
    .fc-wrap-600 { position: relative; height: 600px; }
  </style>
}

<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <div class="btn-group btn-group-sm" role="group" aria-label="Calendar views">
      <button class="btn btn-outline-secondary" data-cal-view="dayGridMonth">Month</button>
      <button class="btn btn-outline-secondary" data-cal-view="timeGridWeek">Week</button>
      <button class="btn btn-outline-secondary" data-cal-view="listMonth">List</button>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-outline-secondary" data-cal="today">Today</button>
      <div id="calTitle" class="fw-semibold"></div>
    </div>
    @if (User.IsInRole("Admin") || User.IsInRole("TA") || User.IsInRole("HOD")) {
      <button class="btn btn-sm btn-primary" id="btnNewEvent">New event</button>
    }
  </div>
  <div class="card-body">
    <div class="fc-wrap-600">
      <div id="orgCalendar"></div>
    </div>
  </div>
</div>

<form id="af" method="post">@Html.AntiForgeryToken()</form>

<div class="offcanvas offcanvas-end" tabindex="-1" id="eventDetails" aria-labelledby="eventDetailsLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="eventDetailsLabel"></h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div id="eventMeta" class="mb-3"></div>
    <div id="eventDescription"></div>
    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-sm btn-outline-primary" type="button" id="btnAddTask">Add to My Tasks</button>
      <button class="btn btn-sm btn-primary d-none" type="button" id="btnShowEdit">Edit</button>
      <button class="btn btn-sm btn-danger d-none" type="button" id="btnDelete">Delete</button>
    </div>
  </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="eventFormCanvas" aria-labelledby="eventFormLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="eventFormLabel"></h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <form id="eventForm">
      <div class="mb-2">
        <label for="evtTitle" class="form-label">Title</label>
        <input type="text" class="form-control" id="evtTitle" required maxlength="160" />
      </div>
      <div class="mb-2">
        <label for="evtCategory" class="form-label">Category</label>
        <select class="form-select" id="evtCategory">
          <option value="Training">Training</option>
          <option value="Holiday">Holiday</option>
          <option value="TownHall">TownHall</option>
          <option value="Hiring">Hiring</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-check form-switch mb-2">
        <input class="form-check-input" type="checkbox" id="evtAllDay" />
        <label class="form-check-label" for="evtAllDay">All day</label>
      </div>
      <div class="mb-2">
        <label for="evtStart" class="form-label">Start</label>
        <input type="datetime-local" class="form-control" id="evtStart" />
      </div>
      <div class="mb-2">
        <label for="evtEnd" class="form-label">End</label>
        <input type="datetime-local" class="form-control" id="evtEnd" />
      </div>
      <div class="mb-2">
        <label for="evtLocation" class="form-label">Location</label>
        <input type="text" class="form-control" id="evtLocation" maxlength="160" />
      </div>
      <div class="mb-2">
        <label for="evtDescription" class="form-label">Description (Markdown)</label>
        <textarea class="form-control" id="evtDescription" rows="4"></textarea>
      </div>
      <div class="d-flex gap-2 mt-3">
        <button type="submit" class="btn btn-primary" id="btnSaveEvent">Save</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas">Cancel</button>
      </div>
    </form>
  </div>
</div>

@section Scripts {
  <script src="~/lib/fullcalendar/core/index.global.min.js" asp-append-version="true"></script>
  <script src="~/lib/fullcalendar/daygrid/index.global.min.js" asp-append-version="true"></script>
  <script src="~/lib/fullcalendar/timegrid/index.global.min.js" asp-append-version="true"></script>
  <script src="~/lib/fullcalendar/list/index.global.min.js" asp-append-version="true"></script>
  <script src="~/lib/fullcalendar/interaction/index.global.min.js" asp-append-version="true"></script>
  <script type="module" src="~/js/calendar.js" asp-append-version="true"></script>
}
