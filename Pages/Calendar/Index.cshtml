@page
@model ProjectManagement.Pages.Calendar.IndexModel
@{
    ViewData["Title"] = "Calendar";
}

@section Styles {
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/calendar.css" asp-append-version="true" />
}

<div class="d-flex align-items-center justify-content-between mb-3">
  <div class="d-flex gap-2 align-items-center">
    <div class="btn-group btn-group-sm me-2" role="group" aria-label="View">
      <button class="btn btn-outline-secondary" data-view="dayGridMonth">Month</button>
      <button class="btn btn-outline-secondary" data-view="timeGridWeek">Week</button>
      <button class="btn btn-outline-secondary" data-view="listMonth">List</button>
      <button class="btn btn-outline-secondary" id="btnToday">Today</button>
    </div>

    <!-- New: Month title + prev/next -->
    <div class="d-flex align-items-center gap-2 ms-2">
      <button class="btn btn-light btn-sm" id="btnPrev" aria-label="Previous"><span aria-hidden="true">‹</span></button>
      <div id="calTitle" class="h5 mb-0 fw-semibold"></div>
      <button class="btn btn-light btn-sm" id="btnNext" aria-label="Next"><span aria-hidden="true">›</span></button>
    </div>
  </div>

  @if (Model.CanEdit)
  {
    <button class="btn btn-success btn-sm"
            id="btnNewEvent"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#eventFormCanvas"
            aria-controls="eventFormCanvas">New Event</button>
  }
</div>

<div class="btn-group btn-group-sm mb-3" id="categoryFilters" role="group" aria-label="Category filter">
  <button class="btn btn-outline-secondary active" data-cat="">All</button>
  <button class="btn btn-outline-secondary" data-cat="Training">Training</button>
  <button class="btn btn-outline-secondary" data-cat="Holiday">Holiday</button>
  <button class="btn btn-outline-secondary" data-cat="TownHall">TownHall</button>
  <button class="btn btn-outline-secondary" data-cat="Hiring">Hiring</button>
  <button class="btn btn-outline-secondary" data-cat="Other">Other</button>
</div>

<div id="calendar"
     class="shadow-sm border rounded-3 bg-white"
     data-can-edit="@Model.CanEdit.ToString().ToLowerInvariant()"></div>

@if (Model.CanEdit)
{
  <!-- Offcanvas: Create/Edit -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="eventFormCanvas" aria-labelledby="eventFormLabel">
    <div class="offcanvas-header">
      <h5 id="eventFormLabel" class="offcanvas-title">New event</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <form id="eventForm" class="vstack gap-3">
        <input type="hidden" name="id" />
        <div>
          <label class="form-label">Title</label>
          <input class="form-control" name="title" maxlength="160" required />
        </div>
        <div class="row g-2">
          <div class="col-6">
            <label class="form-label">Category</label>
            <select class="form-select" name="category">
              <option>Training</option>
              <option>Holiday</option>
              <option>TownHall</option>
              <option>Hiring</option>
              <option selected>Other</option>
            </select>
          </div>
          <div class="col-6">
            <label class="form-label">Location</label>
            <input class="form-control" name="location" maxlength="160" />
          </div>
        </div>

        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="toggleAllDay" name="isAllDay">
          <label class="form-check-label" for="toggleAllDay">All-day</label>
        </div>

        <div class="row g-2" id="timePickers">
          <div class="col-6">
            <label class="form-label">Start</label>
            <input type="datetime-local" class="form-control" name="start" />
          </div>
          <div class="col-6">
            <label class="form-label">End</label>
            <input type="datetime-local" class="form-control" name="end" />
          </div>
        </div>

        <div class="row g-2 d-none" id="datePickers">
          <div class="col-6">
            <label class="form-label">Start date</label>
            <input type="date" class="form-control" name="startDate" />
          </div>
          <div class="col-6">
            <label class="form-label">End date</label>
            <input type="date" class="form-control" name="endDate" />
          </div>
        </div>

        <div>
          <label class="form-label">Description (Markdown)</label>
          <textarea class="form-control" rows="4" name="description"></textarea>
        </div>

        <div class="d-flex gap-2">
          <button class="btn btn-primary" id="btnSaveEvent" type="submit">Save</button>
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="offcanvas">Cancel</button>
        </div>
      </form>
    </div>
  </div>
}

@section Scripts {
  <!-- Order matters: Bootstrap JS → FullCalendar → page script -->
  <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

  <!-- EITHER: single bundle -->
  <script src="~/lib/fullcalendar/bundle/index.global.min.js"></script>

  <!-- OR: individual globals (if you didn’t add the bundle):
  <script src="~/lib/fullcalendar/core/index.global.min.js"></script>
  <script src="~/lib/fullcalendar/daygrid/index.global.min.js"></script>
  <script src="~/lib/fullcalendar/timegrid/index.global.min.js"></script>
  <script src="~/lib/fullcalendar/list/index.global.min.js"></script>
  <script src="~/lib/fullcalendar/interaction/index.global.min.js"></script>
  -->

  <script src="~/js/calendar.js" asp-append-version="true"></script>
}
