@model ProjectManagement.Areas.ProjectOfficeReports.ViewModels.IprRecordRowViewModel

<div class="pm-record-row border rounded-3 p-3 d-flex justify-content-between align-items-start gap-3 mb-2">
    <div class="pm-record-row__body flex-grow-1">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
            <div>
                <div class="fw-semibold">@Model.Title</div>
                <div class="small text-muted">@Model.ProjectName • @Model.IprType • @Model.ApplicationNumber</div>
            </div>
            <span class="pm-chip @Model.StatusChipClass">@Model.Status</span>
        </div>

        @if (!string.IsNullOrWhiteSpace(Model.ExternalRemark))
        {
            <div class="small mt-2">@Model.ExternalRemark</div>
        }

        <div class="mt-3 d-flex flex-wrap gap-2">
            @if (Model.FiledOn.HasValue)
            {
                <span class="pm-chip">Filed: @Model.FiledOn.Value.ToString("dd MMM yyyy")</span>
            }
            @if (Model.GrantedOn.HasValue)
            {
                <span class="pm-chip text-success border-success">Granted: @Model.GrantedOn.Value.ToString("dd MMM yyyy")</span>
            }
            @if (Model.AttachmentCount > 0)
            {
                <span class="pm-chip">Attachments: @Model.AttachmentCount</span>
            }
            else
            {
                <span class="pm-chip pm-chip--muted">No attachments</span>
            }
        </div>

        @if (Model.AttachmentCount > 0)
        {
            <div class="pm-record-row__attachments mt-3">
                <div class="small text-muted mb-1"><i class="bi bi-paperclip"></i> Attachments</div>
                <ul class="list-unstyled mb-0">
                    @foreach (var attachment in Model.Attachments)
                    {
                        <li class="pm-record-row__attachment-item">
                            <div class="fw-semibold">
                                <a asp-area="ProjectOfficeReports"
                                   asp-page="/Ipr/Download"
                                   asp-route-iprRecordId="@Model.Id"
                                   asp-route-attachmentId="@attachment.Id"
                                   class="text-decoration-none"
                                   target="_blank"
                                   rel="noopener noreferrer">
                                    @attachment.FileName
                                </a>
                            </div>
                            <div class="small text-muted">
                                @attachment.FileSize · Uploaded by @attachment.UploadedBy on @attachment.UploadedAt
                            </div>
                        </li>
                    }
                </ul>
            </div>
        }
    </div>
    <div class="dropdown">
        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            Actions
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li>
                <a class="dropdown-item"
                   asp-area="ProjectOfficeReports"
                   asp-page="/Ipr/Index"
                   asp-route-mode="edit"
                   asp-route-id="@Model.Id">
                    Edit in tracker
                </a>
            </li>
            <li>
                <a class="dropdown-item"
                   asp-area="ProjectOfficeReports"
                   asp-page="/Ipr/Manage"
                   asp-route-editId="@Model.Id">
                    Manage record
                </a>
            </li>
        </ul>
    </div>
</div>
