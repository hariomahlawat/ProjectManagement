@using System.Linq
@using System.Text
@using System.Text.Json
@model ProjectManagement.Areas.ProjectOfficeReports.Pages.Training.ManageModel

@{
    var rosterBase64 = Model.Input.RosterPayload ?? string.Empty;

    if (string.IsNullOrWhiteSpace(rosterBase64))
    {
        var rosterPayload = Model.Input.Roster ?? new List<ProjectManagement.Areas.ProjectOfficeReports.Application.TrainingRosterRow>();
        var rosterJson = JsonSerializer.Serialize(rosterPayload.Select(row => new
        {
            id = row.Id,
            armyNumber = row.ArmyNumber,
            rank = row.Rank,
            name = row.Name,
            unitName = row.UnitName,
            category = row.Category
        }));
        rosterBase64 = Convert.ToBase64String(Encoding.UTF8.GetBytes(rosterJson));
    }
    var trainingId = Model.Input.Id?.ToString() ?? string.Empty;
    var rowVersion = Model.Input.RowVersion ?? string.Empty;
}

<div id="trainingRosterContext"
     data-training-id="@trainingId"
     data-row-version="@rowVersion"
     data-rows="@rosterBase64">
    <div class="table-responsive mb-3">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th class="pm-util-col-160">Army number</th>
                    <th class="pm-util-col-140">Rank</th>
                    <th>Name</th>
                    <th>Unit</th>
                    <th class="pm-util-col-140">Category</th>
                    <th class="pm-util-col-80"></th>
                </tr>
            </thead>
            <tbody id="rosterBody"></tbody>
        </table>
    </div>

    <div class="d-flex flex-wrap gap-2">
        <button type="button" class="btn btn-outline-secondary" id="btnAddRosterRow">Add row</button>
    </div>
</div>
