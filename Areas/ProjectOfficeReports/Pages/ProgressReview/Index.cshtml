@page
@using System
@using System.Net
@using System.Text.RegularExpressions
@using ProjectManagement.Services.Reports.ProgressReview
@model ProjectManagement.Areas.ProjectOfficeReports.Pages.ProgressReview.IndexModel
@{
    ViewData["Title"] = "Progress Review";
    var vm = Model.Report;

    string RenderRemarkHtml(string? text)
    {
        if (string.IsNullOrWhiteSpace(text))
        {
            return string.Empty;
        }

        const string mentionPattern = "<span class=\"remark-mention\"[^>]*>(.*?)</span>";
        var replaced = Regex.Replace(
            text,
            mentionPattern,
            match => $"<span class=\"badge remark-pill\">{match.Groups[1].Value}</span>",
            RegexOptions.IgnoreCase | RegexOptions.CultureInvariant);

        var looksHtml = replaced.Contains("<span", StringComparison.OrdinalIgnoreCase)
                        || replaced.Contains("<mark", StringComparison.OrdinalIgnoreCase)
                        || replaced.Contains("<a ", StringComparison.OrdinalIgnoreCase);

        return looksHtml
            ? replaced
            : WebUtility.HtmlEncode(replaced)
                .Replace("\r\n", "<br>")
                .Replace("\n", "<br>");
    }

    string GetActivityBadgeClass(ProjectActivityType type) => type switch
    {
        ProjectActivityType.StageMovement => "progress-review__activity-pill--movement",
        ProjectActivityType.RemarkOnly => "progress-review__activity-pill--remark",
        ProjectActivityType.NoRecentActivity => "progress-review__activity-pill--idle",
        _ => string.Empty
    };

    string GetActivityBadgeIcon(ProjectActivityType type) => type switch
    {
        ProjectActivityType.StageMovement => "bi-lightning-charge",
        ProjectActivityType.RemarkOnly => "bi-chat-text",
        ProjectActivityType.NoRecentActivity => "bi-pause-circle",
        _ => "bi-dot"
    };

    string GetActivityBadgeLabel(ProjectActivityType type) => type switch
    {
        ProjectActivityType.StageMovement => "Stage movement",
        ProjectActivityType.RemarkOnly => "Remark logged",
        ProjectActivityType.NoRecentActivity => "No recent activity",
        _ => "Update"
    };

    string GetStageHeading(ProjectProgressRowVm row) => row.ActivityType switch
    {
        ProjectActivityType.StageMovement => row.StageName ?? "Stage update",
        ProjectActivityType.RemarkOnly => string.IsNullOrWhiteSpace(row.StageName) ? "Latest remark" : row.StageName!,
        ProjectActivityType.NoRecentActivity => row.StageName ?? "Stage pending",
        _ => "Update"
    };

    string GetStageDescription(ProjectProgressRowVm row) => row.ActivityType switch
    {
        ProjectActivityType.RemarkOnly => "No stage change recorded in this period.",
        ProjectActivityType.NoRecentActivity => "Awaiting next milestone.",
        _ => string.Empty
    };

    string GetTimelinePrimary(ProjectProgressRowVm row) => row.ActivityType switch
    {
        ProjectActivityType.NoRecentActivity when row.DaysSinceActivity.HasValue => $"{row.DaysSinceActivity.Value} days",
        ProjectActivityType.NoRecentActivity => "N/A",
        _ when row.ActivityDate.HasValue => row.ActivityDate.Value.ToString("dd MMM"),
        _ => "Date N/A"
    };

    string GetTimelineSecondary(ProjectProgressRowVm row) => row.ActivityType switch
    {
        ProjectActivityType.StageMovement => "Stage updated",
        ProjectActivityType.RemarkOnly => "Remark logged",
        ProjectActivityType.NoRecentActivity => "since last activity",
        _ => string.Empty
    };

    string FormatStageStatus(string? status) => string.IsNullOrWhiteSpace(status) ? "–" : status!;

    string? BuildVisitPhotoUrl(Guid visitId, Guid? photoId)
    {
        if (!photoId.HasValue)
        {
            return null;
        }

        return Url.Page(
            "/ProjectOfficeReports/Visits/ViewPhoto",
            new { area = "ProjectOfficeReports", id = visitId, photoId = photoId.Value, size = "xs" });
    }

    string? BuildSocialPhotoUrl(Guid eventId, Guid? photoId)
    {
        if (!photoId.HasValue)
        {
            return null;
        }

        return Url.Page(
            "/ProjectOfficeReports/SocialMedia/ViewPhoto",
            new { area = "ProjectOfficeReports", id = eventId, photoId = photoId.Value, size = "thumb" });
    }
}

@section Styles {
    <link rel="stylesheet" href="~/css/pages/progress-review.css" asp-append-version="true" />
}

<div class="container-xxl py-4 progress-review" data-page-id="progress-review">
    @* SECTION: Header & filters *@
    <section class="progress-review__controls mb-4">
        <form id="progress-review-filter" method="get">
            <div class="progress-review__controls-head">
                <div>
                    <p class="text-uppercase text-muted small fw-semibold mb-1">Project office report</p>
                    <h1 class="h3 mb-1">Progress Review</h1>
                    @if (vm is not null)
                    {
                        <p class="text-muted mb-0 small">
                            Range: @vm.Range.From.ToString("dd MMM yyyy") – @vm.Range.To.ToString("dd MMM yyyy")
                        </p>
                    }
                </div>
                <div class="progress-review__actions">
                    <button class="btn btn-outline-primary" type="button" data-action="export-pdf">
                        <i class="bi bi-printer me-1"></i>
                        Export / Print
                    </button>
                </div>
            </div>
            <div class="row gy-3 gx-3 align-items-end progress-review__filter-grid">
                <div class="col-12 col-sm-6 col-md-3">
                    <label class="form-label form-label-sm text-muted" for="from">From</label>
                    <input class="form-control" id="from" name="from" type="date" value="@(Model.From?.ToString("yyyy-MM-dd"))" />
                </div>
                <div class="col-12 col-sm-6 col-md-3">
                    <label class="form-label form-label-sm text-muted" for="to">To</label>
                    <input class="form-control" id="to" name="to" type="date" value="@(Model.To?.ToString("yyyy-MM-dd"))" />
                </div>
                <div class="col-12 col-sm-6 col-md-auto">
                    <label class="form-label form-label-sm text-muted d-block">&nbsp;</label>
                    <button class="btn btn-primary w-100" type="submit">Show report</button>
                </div>
            </div>
        </form>
    </section>

    @if (vm is null)
    {
        <div class="alert alert-info">Unable to load progress data for the selected range.</div>
    }
    else
    {
        <article class="progress-review__document">
            <header class="progress-review__document-header">
                <div>
                    <p class="text-uppercase text-muted small fw-semibold mb-1">Reporting period</p>
                    <h2 class="h4 mb-2">@vm.Range.From.ToString("dd MMM yyyy") – @vm.Range.To.ToString("dd MMM yyyy")</h2>
                    <p class="progress-review__lead">
                        During this period, <strong>@vm.Totals.ProjectsMoved</strong> projects progressed to new stages while
                        <strong>@vm.Totals.NonMovers</strong> awaited further action. Teams recorded
                        <strong>@vm.Totals.ProjectsWithRemarks</strong> remarks and conducted
                        <strong>@vm.Totals.VisitsCount</strong> field visits.
                    </p>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm mb-0 progress-review__summary-table">
                        <thead>
                            <tr>
                                <th scope="col">Indicator</th>
                                <th scope="col" class="text-end">Value</th>
                                <th scope="col">Observation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Projects moved</td>
                                <td class="text-end fw-semibold">@vm.Totals.ProjectsMoved</td>
                                <td>Progressed to subsequent stages.</td>
                            </tr>
                            <tr>
                                <td>Projects with remarks</td>
                                <td class="text-end fw-semibold">@vm.Totals.ProjectsWithRemarks</td>
                                <td>Leadership attention and field notes.</td>
                            </tr>
                            <tr>
                                <td>Non-movers</td>
                                <td class="text-end fw-semibold">@vm.Totals.NonMovers</td>
                                <td>Awaiting milestones or inputs.</td>
                            </tr>
                            <tr>
                                <td>Visits recorded</td>
                                <td class="text-end fw-semibold">@vm.Totals.VisitsCount</td>
                                <td>Stakeholder and site interactions.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </header>

            @* SECTION: Project progress buckets *@
            <section class="progress-review__section" id="project-progress">
                <header class="progress-review__section-header">
                    <span class="progress-review__section-label">Section 01</span>
                    <h2 class="progress-review__section-title">Project progress review</h2>
                    <p class="progress-review__section-subtitle">Movement, remarks, and idle projects consolidated per project.</p>
                </header>
                <div class="table-responsive">
                    <table class="table table-sm align-middle progress-review__table">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Project</th>
                                <th scope="col">Stage / status</th>
                                <th scope="col">Last update</th>
                                <th scope="col">Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var row in vm.Projects.SummaryRows)
                            {
                                var remarkHtml = RenderRemarkHtml(row.RemarkSummary);
                                var hasRemark = !string.IsNullOrWhiteSpace(row.RemarkSummary);
                                var badgeClass = GetActivityBadgeClass(row.ActivityType);
                                var badgeIcon = GetActivityBadgeIcon(row.ActivityType);
                                var badgeLabel = GetActivityBadgeLabel(row.ActivityType);
                                var stageHeading = GetStageHeading(row);
                                var timelinePrimary = GetTimelinePrimary(row);
                                var timelineSecondary = GetTimelineSecondary(row);
                                var hasStageTransition = row.ActivityType == ProjectActivityType.StageMovement;
                                var stageMovements = row.StageMovements ?? Array.Empty<ProjectStageMovementVm>();
                                var hasStageTimeline = hasStageTransition && stageMovements.Any();

                                <tr>
                                    <td>
                                        <div class="progress-review__project-name">@row.ProjectName</div>
                                        <span class="progress-review__activity-pill @badgeClass">
                                            <i class="bi @badgeIcon" aria-hidden="true"></i>
                                            <span>@badgeLabel</span>
                                        </span>
                                    </td>
                                    <td>
                                        <div class="fw-semibold">@stageHeading</div>
                                        @if (hasStageTimeline)
                                        {
                                            <ul class="progress-review__stage-list">
                                                @foreach (var movement in stageMovements)
                                                {
                                                    <li class="progress-review__stage-list-item">
                                                        <div class="progress-review__stage-list-header">
                                                            <span class="fw-semibold">@movement.StageName</span>
                                                            <span class="text-muted small">@movement.ChangeDate.ToString("dd MMM")</span>
                                                        </div>
                                                        <div class="progress-review__stage-statuses">
                                                            <span class="progress-review__stage-status progress-review__stage-status--from">@FormatStageStatus(movement.FromStatus)</span>
                                                            <span class="text-muted small">→</span>
                                                            <span class="progress-review__stage-status progress-review__stage-status--to">@FormatStageStatus(movement.ToStatus)</span>
                                                        </div>
                                                    </li>
                                                }
                                            </ul>
                                        }
                                        else
                                        {
                                            var stageDescription = GetStageDescription(row);
                                            if (!string.IsNullOrWhiteSpace(stageDescription))
                                            {
                                                <div class="text-muted small mt-1">@stageDescription</div>
                                            }
                                        }
                                    </td>
                                    <td>
                                        <div class="fw-semibold">@timelinePrimary</div>
                                        @if (!string.IsNullOrWhiteSpace(timelineSecondary))
                                        {
                                            <div class="text-muted small">@timelineSecondary</div>
                                        }
                                    </td>
                                    <td class="progress-review__cell-truncate">
                                        @if (hasRemark)
                                        {
                                            <div class="progress-review__remark">@Html.Raw(remarkHtml)</div>
                                        }
                                        else
                                        {
                                            <span class="text-muted small">No remarks captured.</span>
                                        }
                                    </td>
                                </tr>
                            }
                            @if (!vm.Projects.SummaryRows.Any())
                            {
                                <tr>
                                    <td colspan="4" class="text-muted text-center small">No qualifying projects for the selected range.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </section>

            @* SECTION: Field engagement & outreach *@
            <section class="progress-review__section" id="field-engagement">
                <header class="progress-review__section-header">
                    <span class="progress-review__section-label">Section 02</span>
                    <h2 class="progress-review__section-title">Field engagement & outreach</h2>
                    <p class="progress-review__section-subtitle">Site visits and social narratives captured for documentation.</p>
                </header>
                <div class="row g-4 progress-review__split">
                    <div class="col-lg-6">
                        <h3 class="progress-review__subheading">Visits log</h3>
                        <p class="text-muted small mb-3">@vm.Visits.TotalCount entries reviewed.</p>
                        @if (!vm.Visits.Items.Any())
                        {
                            <p class="text-muted mb-0">No visits recorded in this range.</p>
                        }
                        else
                        {
                            <ul class="list-unstyled mb-0 progress-review__media-list">
                                @foreach (var visit in vm.Visits.Items.Take(6))
                                {
                                    var visitPhotoUrl = BuildVisitPhotoUrl(visit.Id, visit.CoverPhotoId);
                                    <li class="progress-review__media-item">
                                        @if (!string.IsNullOrWhiteSpace(visitPhotoUrl))
                                        {
                                            <div class="progress-review__media-thumb">
                                                <img src="@visitPhotoUrl" alt="@($"{visit.VisitorName} visit photo")" loading="lazy" width="72" height="72" />
                                            </div>
                                        }
                                        <div class="progress-review__media-body">
                                            <div class="fw-semibold">@visit.VisitorName <span class="text-muted fw-normal">(@visit.VisitType)</span></div>
                                            <div class="small text-muted">@visit.Date.ToString("dd MMM") · Strength @visit.Strength</div>
                                            @if (!string.IsNullOrWhiteSpace(visit.Remarks))
                                            {
                                                <div class="text-muted small">@visit.Remarks</div>
                                            }
                                            else
                                            {
                                                <div class="text-muted small">No remarks shared.</div>
                                            }
                                        </div>
                                    </li>
                                }
                            </ul>
                        }
                    </div>
                    <div class="col-lg-6">
                        <h3 class="progress-review__subheading">Social media</h3>
                        <p class="text-muted small mb-3">@vm.SocialMedia.TotalCount posts amplified.</p>
                        @if (!vm.SocialMedia.Items.Any())
                        {
                            <p class="text-muted mb-0">No social media updates in this range.</p>
                        }
                        else
                        {
                            <ul class="list-unstyled mb-0 progress-review__media-list">
                                @foreach (var post in vm.SocialMedia.Items.Take(6))
                                {
                                    var postPhotoUrl = BuildSocialPhotoUrl(post.Id, post.CoverPhotoId);
                                    <li class="progress-review__media-item">
                                        @if (!string.IsNullOrWhiteSpace(postPhotoUrl))
                                        {
                                            <div class="progress-review__media-thumb">
                                                <img src="@postPhotoUrl" alt="@($"{post.Title} social post")" loading="lazy" width="72" height="72" />
                                            </div>
                                        }
                                        <div class="progress-review__media-body">
                                            <div class="fw-semibold">@post.Title</div>
                                            <div class="small text-muted">@post.Date.ToString("dd MMM") · @post.Platform</div>
                                            @if (!string.IsNullOrWhiteSpace(post.Description))
                                            {
                                                <div class="text-muted small">@post.Description</div>
                                            }
                                            else
                                            {
                                                <div class="text-muted small">No caption provided.</div>
                                            }
                                        </div>
                                    </li>
                                }
                            </ul>
                        }
                    </div>
                </div>
            </section>

            @* SECTION: Technology transfer & IPR *@
            <section class="progress-review__section" id="tech-transfer">
                <header class="progress-review__section-header">
                    <span class="progress-review__section-label">Section 03</span>
                    <h2 class="progress-review__section-title">Technology transfer & IPR</h2>
                    <p class="progress-review__section-subtitle">Stage transitions, agreements, and legal highlights.</p>
                </header>
                <div class="row g-4 progress-review__split">
                    <div class="col-lg-6">
                        <h3 class="progress-review__subheading">Transfer of Technology</h3>
                        <div class="progress-review__mini-section">
                            <h4 class="progress-review__mini-heading">Stage changes</h4>
                            <ul class="list-unstyled small progress-review__list">
                                @foreach (var entry in vm.Tot.StageChanges.Take(8))
                                {
                                    <li>
                                        <strong>@entry.ProjectName</strong>
                                        <span class="text-muted">(@entry.ChangeDate.ToString("dd MMM"))</span>
                                        <div>@entry.StageName: @entry.FromStatus → @entry.ToStatus</div>
                                    </li>
                                }
                                @if (!vm.Tot.StageChanges.Any())
                                {
                                    <li class="text-muted">No stage changes recorded.</li>
                                }
                            </ul>
                        </div>
                        <div class="progress-review__mini-section">
                            <h4 class="progress-review__mini-heading">Remarks</h4>
                            <ul class="list-unstyled small progress-review__list">
                                @foreach (var entry in vm.Tot.Remarks.Take(8))
                                {
                                    <li>
                                        <strong>@entry.ProjectName</strong>
                                        <span class="text-muted">(@entry.Date.ToString("dd MMM"))</span>
                                        <div>@entry.Summary</div>
                                    </li>
                                }
                                @if (!vm.Tot.Remarks.Any())
                                {
                                    <li class="text-muted">No remarks captured.</li>
                                }
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h3 class="progress-review__subheading">IPR updates</h3>
                        <div class="progress-review__mini-section">
                            <h4 class="progress-review__mini-heading">Status changes</h4>
                            <ul class="list-unstyled small progress-review__list">
                                @foreach (var entry in vm.Ipr.StatusChanges.Take(8))
                                {
                                    <li>
                                        <strong>@entry.Title</strong>
                                        <span class="text-muted">(@entry.EventDate.ToString("dd MMM"))</span>
                                        <div>@entry.Status — @entry.Notes</div>
                                    </li>
                                }
                                @if (!vm.Ipr.StatusChanges.Any())
                                {
                                    <li class="text-muted">No status transitions this period.</li>
                                }
                            </ul>
                        </div>
                        <div class="progress-review__mini-section">
                            <h4 class="progress-review__mini-heading">Remarks</h4>
                            <ul class="list-unstyled small progress-review__list">
                                @foreach (var entry in vm.Ipr.Remarks.Take(8))
                                {
                                    <li>
                                        <strong>@entry.Title</strong>
                                        <span class="text-muted">(@entry.EventDate.ToString("dd MMM"))</span>
                                        <div>@entry.Summary</div>
                                    </li>
                                }
                                @if (!vm.Ipr.Remarks.Any())
                                {
                                    <li class="text-muted">No remarks captured.</li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            @* SECTION: Training *@
            <section class="progress-review__section" id="training">
                <header class="progress-review__section-header">
                    <span class="progress-review__section-label">Section 04</span>
                    <h2 class="progress-review__section-title">Training & capability building</h2>
                    <p class="progress-review__section-subtitle">Simulator and drone training efforts for the period.</p>
                </header>
                <div class="row g-4 progress-review__split">
                    <div class="col-lg-6">
                        <h3 class="progress-review__subheading">Simulator training (@vm.Training.Simulator.TotalPersons participants)</h3>
                        <div class="table-responsive">
                            <table class="table table-sm mb-0 progress-review__table">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">Date</th>
                                        <th scope="col">Title</th>
                                        <th scope="col">Unit / Org</th>
                                        <th scope="col">Persons</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var row in vm.Training.Simulator.Rows.Take(8))
                                    {
                                        <tr>
                                            <td>@row.Date.ToString("dd MMM")</td>
                                            <td>@row.Title</td>
                                            <td>@row.UnitOrOrg</td>
                                            <td>@row.Persons</td>
                                        </tr>
                                    }
                                    @if (!vm.Training.Simulator.Rows.Any())
                                    {
                                        <tr>
                                            <td colspan="4" class="text-muted text-center small">No simulator trainings recorded.</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h3 class="progress-review__subheading">Drone training (@vm.Training.Drone.TotalPersons participants)</h3>
                        <div class="table-responsive">
                            <table class="table table-sm mb-0 progress-review__table">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">Date</th>
                                        <th scope="col">Title</th>
                                        <th scope="col">Unit / Org</th>
                                        <th scope="col">Persons</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var row in vm.Training.Drone.Rows.Take(8))
                                    {
                                        <tr>
                                            <td>@row.Date.ToString("dd MMM")</td>
                                            <td>@row.Title</td>
                                            <td>@row.UnitOrOrg</td>
                                            <td>@row.Persons</td>
                                        </tr>
                                    }
                                    @if (!vm.Training.Drone.Rows.Any())
                                    {
                                        <tr>
                                            <td colspan="4" class="text-muted text-center small">No drone trainings recorded.</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            @* SECTION: Proliferation & FFC *@
            <section class="progress-review__section" id="proliferation">
                <header class="progress-review__section-header">
                    <span class="progress-review__section-label">Section 05</span>
                    <h2 class="progress-review__section-title">Proliferation & FFC simulators</h2>
                    <p class="progress-review__section-subtitle">Distribution events and FFC milestones captured for record.</p>
                </header>
                <div class="row g-4 progress-review__split">
                    <div class="col-lg-7">
                        <h3 class="progress-review__subheading">Proliferation (@vm.Proliferation.Rows.Count records)</h3>
                        <div class="table-responsive">
                            <table class="table table-sm mb-0 progress-review__table">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">Date</th>
                                        <th scope="col">Project</th>
                                        <th scope="col">Unit</th>
                                        <th scope="col">Qty</th>
                                        <th scope="col">Source</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var row in vm.Proliferation.Rows.Take(10))
                                    {
                                        <tr>
                                            <td>@row.Date.ToString("dd MMM")</td>
                                            <td>@row.ProjectName</td>
                                            <td>@row.UnitOrCountry</td>
                                            <td>@row.Quantity</td>
                                            <td>@row.Source</td>
                                        </tr>
                                    }
                                    @if (!vm.Proliferation.Rows.Any())
                                    {
                                        <tr>
                                            <td colspan="5" class="text-muted text-center small">No proliferation entries for this range.</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <h3 class="progress-review__subheading">FFC simulators (@vm.Ffc.Rows.Count milestones)</h3>
                        @if (!vm.Ffc.Rows.Any())
                        {
                            <p class="text-muted mb-0">No milestones in this range.</p>
                        }
                        else
                        {
                            <ul class="list-unstyled small mb-0 progress-review__list">
                                @foreach (var row in vm.Ffc.Rows.Take(10))
                                {
                                    <li>
                                        <strong>@row.Country</strong> — @row.Milestone
                                        <span class="text-muted">(@row.Date.ToString("dd MMM"))</span>
                                        <div class="text-muted">@row.Remarks</div>
                                    </li>
                                }
                            </ul>
                        }
                    </div>
                </div>
            </section>

            @* SECTION: Miscellaneous activities *@
            <section class="progress-review__section" id="miscellaneous">
                <header class="progress-review__section-header">
                    <span class="progress-review__section-label">Section 06</span>
                    <h2 class="progress-review__section-title">Miscellaneous activities</h2>
                    <p class="progress-review__section-subtitle">Additional highlights requiring documentation.</p>
                </header>
                @if (!vm.Misc.Rows.Any())
                {
                    <p class="text-muted mb-0">No activities captured in this range.</p>
                }
                else
                {
                    <div class="row g-4 progress-review__split">
                        @foreach (var activity in vm.Misc.Rows.Take(10))
                        {
                            <div class="col-md-6">
                                <article class="progress-review__activity-card h-100">
                                    @if (!string.IsNullOrWhiteSpace(activity.PhotoUrl))
                                    {
                                        <img class="progress-review__activity-photo" src="@activity.PhotoUrl" alt="@($"{activity.Title} photo")" loading="lazy" />
                                    }
                                    <p class="text-muted small mb-1">@activity.Date.ToString("dd MMM") · @activity.Location</p>
                                    <h3 class="h6">@activity.Title</h3>
                                    @if (!string.IsNullOrWhiteSpace(activity.Summary))
                                    {
                                        <p class="text-muted small mb-0">@activity.Summary</p>
                                    }
                                    else
                                    {
                                        <p class="text-muted small mb-0">No description available.</p>
                                    }
                                </article>
                            </div>
                        }
                    </div>
                }
            </section>
        </article>
    }
</div>

@section Scripts {
    <script src="~/js/pages/project-office-reports/progress-review.js" asp-append-version="true"></script>
}
