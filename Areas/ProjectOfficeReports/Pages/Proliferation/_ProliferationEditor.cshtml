@using ProjectManagement.Areas.ProjectOfficeReports.Proliferation.ViewModels

@model ProliferationEditorBootVm

@{
    var defaults = Model.Defaults;
    var defaultProjectId = defaults.ProjectId?.ToString() ?? string.Empty;
    var defaultSource = defaults.Source.HasValue ? ((int)defaults.Source.Value).ToString() : string.Empty;
    var defaultYear = defaults.Year?.ToString() ?? string.Empty;
    var defaultKind = defaults.Kind switch
    {
        ProliferationRecordKind.Yearly => "yearly",
        ProliferationRecordKind.Granular => "granular",
        _ => string.Empty
    };

}

<div class="pf-manage-stack">
    <div class="card shadow-sm pf-manage-card pf-manage-card--editor" id="pf-editor"
         data-current-year="@Model.CurrentYear"
         data-boot-project-id="@defaultProjectId"
         data-boot-source="@defaultSource"
         data-boot-year="@defaultYear"
         data-boot-kind="@defaultKind">
        <div class="card-header border-0 pb-0">
            <div class="d-flex flex-column gap-3">
                <div>
                    <h3 class="card-title h5 mb-0">Edit proliferation data</h3>
                    <p class="card-subtitle text-muted small mb-0">Switch between granular entries and yearly totals for the selected project.</p>
                </div>
                <ul class="nav nav-tabs card-header-tabs" id="pf-editor-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab-granular" data-target="granular" type="button" role="tab">Granular Entry</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-yearly" data-target="yearly" type="button" role="tab">Yearly Total</button>
                    </li>
                </ul>
            </div>
        </div>
        <div class="card-body">
            <div class="bg-light border rounded-3 p-3 mb-4" id="pf-approval-panel" data-approval-container>
                <div class="d-flex flex-wrap align-items-center gap-2">
                    <span class="badge text-bg-secondary" data-approval-badge>Awaiting selection</span>
                    <span class="fw-semibold" data-approval-status>Select a record to review approval status.</span>
                </div>
                <div class="small text-muted mt-2" data-approval-submitted>Submitted: —</div>
                <div class="small text-muted" data-approval-updated>Last updated: —</div>
                <div class="small text-muted" data-approval-decided hidden>Decision: —</div>
            </div>
            <form id="pf-form" novalidate>
                <input type="hidden" id="pf-id" />
                <input type="hidden" id="pf-kind" value="granular" />
                <input type="hidden" id="pf-row-version" />

                <div class="mb-3">
                    <label class="form-label" for="pf-project">Project name / simulator name</label>
                    <select id="pf-project" class="form-select" aria-describedby="pf-project-error" required>
                        @foreach (var project in Model.CompletedProjects)
                        {
                            <option value="@project.Id">@project.DisplayName</option>
                        }
                    </select>
                    <div class="form-text text-danger small d-none" id="pf-project-error" data-field-error="project" aria-live="polite"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="pf-source">Source</label>
                    <select id="pf-source" class="form-select" aria-describedby="pf-source-error" required>
                        @foreach (var source in Model.SourceOptions)
                        {
                            <option value="@source.Value">@source.Label</option>
                        }
                    </select>
                    <div class="form-text text-danger small d-none" id="pf-source-error" data-field-error="source" aria-live="polite"></div>
                </div>

                <div class="row g-3">
                    <div class="col-sm-6">
                        <label class="form-label" for="pf-year">Year</label>
                        <input id="pf-year" type="number" class="form-control" min="2000" max="3000" value="@Model.CurrentYear" aria-describedby="pf-year-error" required />
                        <div class="form-text text-danger small d-none" id="pf-year-error" data-field-error="year" aria-live="polite"></div>
                    </div>
                    <div class="col-sm-6 granular-only">
                        <label class="form-label" for="pf-date">Proliferation date</label>
                        <input id="pf-date" type="date" class="form-control" aria-describedby="pf-date-error" />
                        <div class="form-text text-danger small d-none" id="pf-date-error" data-field-error="date" aria-live="polite"></div>
                    </div>
                </div>

                <div class="granular-only mt-3">
                    <label class="form-label" for="pf-unit">Unit name</label>
                    <input id="pf-unit" type="text" class="form-control" maxlength="200" aria-describedby="pf-unit-error" />
                    <div class="form-text text-danger small d-none" id="pf-unit-error" data-field-error="unit" aria-live="polite"></div>
                </div>

                <div class="mt-3">
                    <label class="form-label" for="pf-qty">Quantity</label>
                    <input id="pf-qty" type="number" min="0" class="form-control" aria-describedby="pf-qty-error" required />
                    <div class="form-text text-danger small d-none" id="pf-qty-error" data-field-error="qty" aria-live="polite"></div>
                </div>

                <div class="mt-3">
                    <label class="form-label" for="pf-remarks">Remarks</label>
                    <textarea id="pf-remarks" class="form-control" rows="3" maxlength="500" aria-describedby="pf-remarks-help"></textarea>
                    <div class="form-text text-muted small" id="pf-remarks-help">Optional</div>
                </div>

                <div class="mt-4 d-flex flex-wrap justify-content-end gap-2">
                    <button class="btn btn-outline-secondary" id="pf-reset" type="button">Reset</button>
                </div>
            </form>
        </div>
    </div>
</div>
