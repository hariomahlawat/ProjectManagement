@using ProjectManagement.Areas.ProjectOfficeReports.Proliferation.ViewModels

@model ProliferationEditorBootVm

@{
    var defaults = Model.Defaults;
    var defaultProjectId = defaults.ProjectId?.ToString() ?? string.Empty;
    var defaultSource = defaults.Source.HasValue ? ((int)defaults.Source.Value).ToString() : string.Empty;
    var defaultYear = defaults.Year?.ToString() ?? string.Empty;
    var defaultKind = defaults.Kind switch
    {
        ProliferationRecordKind.Yearly => "yearly",
        ProliferationRecordKind.Granular => "granular",
        _ => string.Empty
    };

    var overridesModel = ViewData["ProliferationOverrides"] as ProliferationPreferenceOverridesBootVm;
}

<div class="pf-editor-stack">
    <div class="card shadow-sm pf-panel-card pf-panel-card--editor" id="pf-editor"
     data-current-year="@Model.CurrentYear"
     data-boot-project-id="@defaultProjectId"
     data-boot-source="@defaultSource"
     data-boot-year="@defaultYear"
     data-boot-kind="@defaultKind">
        <div class="card-header border-0 pb-0">
            <div class="d-flex flex-column flex-xl-row align-items-xl-end gap-3">
                <div class="pf-panel-heading flex-grow-1">
                    <h3 class="card-title h5 mb-1">Editor</h3>
                    <p class="card-subtitle text-muted small mb-0">Select a result to edit, or start a new granular or yearly entry.</p>
                </div>
                <ul class="nav nav-tabs card-header-tabs pf-editor-tabs mt-3 mt-xl-0" id="pf-editor-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="tab-granular" data-target="granular" type="button" role="tab">Granular Entry</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tab-yearly" data-target="yearly" type="button" role="tab">Yearly Total</button>
                    </li>
                </ul>
            </div>
        </div>
        <div class="card-body pt-3">
            <form id="pf-form" novalidate>
                <input type="hidden" id="pf-id" />
                <input type="hidden" id="pf-kind" value="granular" />
                <input type="hidden" id="pf-row-version" />

                <div class="mb-3">
                    <label class="form-label" for="pf-project">Project name / simulator name</label>
                    <select id="pf-project" class="form-select">
                        @foreach (var project in Model.CompletedProjects)
                        {
                            <option value="@project.Id">@project.DisplayName</option>
                        }
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="pf-source">Source</label>
                    <select id="pf-source" class="form-select">
                        @foreach (var source in Model.SourceOptions)
                        {
                            <option value="@source.Value">@source.Label</option>
                        }
                    </select>
                </div>

                <div class="row g-3">
                    <div class="col-sm-6">
                        <label class="form-label" for="pf-year">Year</label>
                        <input id="pf-year" type="number" class="form-control" min="2000" max="3000" value="@Model.CurrentYear" />
                    </div>
                    <div class="col-sm-6 granular-only">
                        <label class="form-label" for="pf-date">Proliferation date</label>
                        <input id="pf-date" type="date" class="form-control" />
                    </div>
                </div>

                <div class="granular-only mt-3">
                    <label class="form-label" for="pf-unit">Unit name</label>
                    <input id="pf-unit" type="text" class="form-control" maxlength="200" />
                </div>

                <div class="mt-3">
                    <label class="form-label" for="pf-qty">Quantity</label>
                    <input id="pf-qty" type="number" min="0" class="form-control" />
                </div>

                <div class="mt-3">
                    <label class="form-label" for="pf-remarks">Remarks</label>
                    <textarea id="pf-remarks" class="form-control" rows="3" maxlength="500"></textarea>
                </div>

                <div class="mt-4 d-flex gap-2">
                    <button class="btn btn-primary" id="pf-save" type="submit">Save</button>
                    <button class="btn btn-outline-secondary" id="pf-reset" type="button">Reset</button>
                    <button class="btn btn-outline-danger ms-auto" id="pf-delete" type="button" disabled>Delete</button>
                </div>
            </form>
        </div>
    </div>

    @if (overridesModel is not null)
    {
        <div class="pf-editor-stack__overrides mt-4">
            <partial name="_PreferenceOverrides" model="overridesModel" />
        </div>
    }
</div>
