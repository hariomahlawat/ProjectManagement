@using ProjectManagement.Areas.ProjectOfficeReports.Proliferation.ViewModels

@model ProliferationListBootVm

@{
    var defaults = Model.Defaults;
    var defaultProjectId = defaults.ProjectId?.ToString() ?? string.Empty;
    var defaultSource = defaults.Source.HasValue ? ((int)defaults.Source.Value).ToString() : string.Empty;
    var defaultYear = defaults.Year?.ToString() ?? string.Empty;
    var defaultKind = defaults.Kind switch
    {
        ProliferationRecordKind.Yearly => "yearly",
        ProliferationRecordKind.Granular => "granular",
        _ => string.Empty
    };

    var projectOptions = Model.CompletedProjects
        .Select(p => new ProliferationFilterOption(p.Id.ToString(), p.DisplayName))
        .ToList();

    var sourceOptions = Model.SourceOptions
        .Select(s => new ProliferationFilterOption(s.Value.ToString(), s.Label))
        .ToList();

    var toolbarModel = ProliferationFilterToolbarModel.Create(
        context: "manage",
        projects: projectOptions,
        sources: sourceOptions,
        searchPlaceholder: "Search projects or remarks"
    );
}

<div class="card shadow-sm pf-manage-card pf-manage-card--list" id="pf-list-card"
     data-default-year="@Model.CurrentYear"
     data-page-size="@Model.DefaultPageSize"
     data-boot-project-id="@defaultProjectId"
     data-boot-source="@defaultSource"
     data-boot-year="@defaultYear"
     data-boot-kind="@defaultKind">
    <div class="card-header border-0 pb-0">
        <div class="d-flex flex-column gap-1">
            <h3 class="card-title h5 mb-0">Find proliferation records</h3>
            <p class="card-subtitle text-muted small mb-0">Use the filters below to browse existing entries.</p>
        </div>
    </div>
    <div class="card-body pt-3">
        <partial name="~/Areas/ProjectOfficeReports/Pages/Proliferation/Partials/_FilterToolbar.cshtml" model="toolbarModel" />
    </div>
    <div class="card-body border-top">
        <div class="d-flex flex-column gap-1">
            <h4 class="h6 mb-0">Results</h4>
            <p class="text-muted small mb-0">Select a record to load it in the editor.</p>
        </div>
    </div>
    <div class="list-group list-group-flush pf-manage-results" id="pf-list" role="listbox" aria-live="polite">
        <div class="list-group-item text-muted" data-placeholder>Use the filters to load entries.</div>
    </div>

    <div class="card-footer d-flex flex-wrap justify-content-between align-items-center gap-2">
        <div id="pf-count" class="small text-muted" aria-live="polite"></div>
        <nav aria-label="Proliferation pagination">
            <ul class="pagination pagination-sm mb-0" id="pf-pager"></ul>
        </nav>
    </div>
</div>
