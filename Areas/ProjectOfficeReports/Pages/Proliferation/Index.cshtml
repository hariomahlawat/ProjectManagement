@page
@model ProjectManagement.Areas.ProjectOfficeReports.Pages.Proliferation.IndexModel
@{
    ViewData["Title"] = "Proliferation Tracker";
}

<div class="container-fluid px-4 py-4" data-page="proliferation">
    <div class="row align-items-start gy-3 mb-4">
        <div class="col">
            <h1 class="h2 mb-1 fw-semibold">Proliferation Tracker</h1>
            <p class="text-muted mb-0">Monitor proliferation outcomes, apply granular or yearly totals, and keep stakeholders aligned.</p>
        </div>
        <div class="col-auto">
            <div class="btn-toolbar gap-2" role="toolbar" aria-label="Proliferation actions">
                <div class="btn-group" role="group" aria-label="Record actions">
                    <a class="btn btn-primary" asp-area="ProjectOfficeReports" asp-page="/Proliferation/Manage" asp-fragment="granular">
                        <span class="me-1" aria-hidden="true">+</span>Granular Entry
                    </a>
                    <a class="btn btn-outline-primary" asp-area="ProjectOfficeReports" asp-page="/Proliferation/Manage" asp-fragment="yearly">
                        <span class="me-1" aria-hidden="true">+</span>Yearly Total
                    </a>
                </div>
                <div class="btn-group" role="group" aria-label="Data actions">
                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#mdlImport">
                        Import
                    </button>
                    <button type="button" class="btn btn-outline-success" id="btnExport">Export CSV</button>
                </div>
                <div class="btn-group" role="group" aria-label="Management actions">
                    <a class="btn btn-secondary" asp-area="ProjectOfficeReports" asp-page="/Proliferation/Manage">
                        Manage Proliferation
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 align-items-start">
        <div class="col-12 col-xxl-9">
            <section class="mb-4" aria-labelledby="portfolio-overview-heading">
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-4">
                        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-start gap-3 mb-3">
                            <div>
                                <h2 id="portfolio-overview-heading" class="h5 mb-1">Portfolio overview</h2>
                                <p class="text-muted mb-0">Understand how effective totals are derived across sources.</p>
                            </div>
                            <span class="text-muted small" id="kpiLastUpdated" aria-live="polite"></span>
                        </div>
                        <partial name="Partials/_Kpis" />
                    </div>
                </div>
            </section>

            <section class="mb-4" aria-labelledby="filters-heading">
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-4">
                        <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-3">
                            <div>
                                <h2 id="filters-heading" class="h5 mb-1">Filters</h2>
                                <p class="text-muted mb-0">Toggle years or date ranges, and refine by category or source.</p>
                            </div>
                        </div>
                        <partial name="Partials/_FilterBar" />
                    </div>
                </div>
            </section>

            <partial name="Partials/_EntryWorkspace" />
        </div>
        <aside class="col-12 col-xxl-3">
            <section class="card border-0 shadow-sm rounded-4" aria-labelledby="year-preferences-heading">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h2 id="year-preferences-heading" class="h5 mb-1">Year preferences</h2>
                            <p class="text-muted mb-0 small">Control how totals are derived per project-year.</p>
                        </div>
                        <span class="badge text-bg-success" id="prefStatusLabel">Active</span>
                    </div>
                    <partial name="_ReconciliationPanel" model="Model.CanManagePreferences" />
                </div>
            </section>
        </aside>
    </div>
</div>

<partial name="Partials/_ImportModal" />

<div class="toast-container position-fixed top-0 end-0 p-3" id="toastHost" aria-live="polite" aria-atomic="true"></div>

<link rel="stylesheet" href="~/css/proliferation.css" asp-append-version="true" />
<script src="~/js/pages/proliferation-dashboard.js" asp-append-version="true" defer></script>
