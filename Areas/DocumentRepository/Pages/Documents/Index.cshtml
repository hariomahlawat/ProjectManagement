@page
@model ProjectManagement.Areas.DocumentRepository.Pages.Documents.IndexModel
@{
    ViewData["Title"] = "Document repository";
}

@section Styles {
    <link rel="stylesheet" href="~/css/docrepo-ui.css" asp-append-version="true" />
}

<div class="container-fluid py-4">

    <nav aria-label="breadcrumb" class="mb-2">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a asp-area="" asp-page="/Index">Dashboard</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Documents</li>
        </ol>
    </nav>

    <!-- search bar -->
    <div class="docrepo-search-shell">
        <form method="get" class="docrepo-searchbar" data-docrepo-filter>
            <div class="docrepo-search-input">
                <i class="bi bi-search"></i>
                <input type="search"
                       name="q"
                       value="@Model.Q"
                       placeholder="Search documents (subject, sender, tags)…"
                       aria-label="Search documents" />
            </div>
            <div class="docrepo-search-actions">
                <button type="submit" class="btn btn-primary px-4">Search</button>
                <button type="button"
                        class="btn btn-outline-secondary"
                        data-bs-toggle="modal"
                        data-bs-target="#docrepoFilterModal">
                    <i class="bi bi-funnel"></i>
                    <span class="d-none d-sm-inline">Filters</span>
                </button>
            </div>

            <input type="hidden" name="page" value="@Model.PageNumber" />
            <input type="hidden" name="pageSize" value="@Model.PageSize" />
        </form>
    </div>

    <partial name="_Pager" model="new PagerModel(Model.PageNumber, Model.PageSize, Model.TotalCount, Request)" />

    @if (!Model.Items.Any())
    {
        <div class="alert alert-light border">No documents found.</div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3">
            @foreach (var d in Model.Items)
            {
                <div class="col">
                    @await Html.PartialAsync("_DocumentCard", d)
                </div>
            }
        </div>
    }

    <partial name="_Pager" model="new PagerModel(Model.PageNumber, Model.PageSize, Model.TotalCount, Request)" />
</div>

<!-- filter modal -->
<div class="modal fade" id="docrepoFilterModal" tabindex="-1" aria-labelledby="docrepoFilterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="get">
                <div class="modal-header">
                    <h5 class="modal-title" id="docrepoFilterModalLabel">Filters</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="q" value="@Model.Q" />

                    <div class="mb-3">
                        <label class="form-label" for="tagInput">Tag</label>
                        <input class="form-control" id="tagInput" name="tag" value="@Model.Tag" placeholder="e.g. sow, contract" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="officeSelect">Office</label>
                        <select class="form-select" id="officeSelect" name="officeCategoryId">
                            <option value="">All offices</option>
                            @foreach (var office in Model.OfficeCategories)
                            {
                                if (Model.OfficeCategoryId == office.Id)
                                {
                                    <option value="@office.Id" selected>@office.Name</option>
                                }
                                else
                                {
                                    <option value="@office.Id">@office.Name</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="docTypeSelect">Document type</label>
                        <select class="form-select" id="docTypeSelect" name="documentCategoryId">
                            <option value="">All document types</option>
                            @foreach (var docCat in Model.DocumentCategories)
                            {
                                if (Model.DocumentCategoryId == docCat.Id)
                                {
                                    <option value="@docCat.Id" selected>@docCat.Name</option>
                                }
                                else
                                {
                                    <option value="@docCat.Id">@docCat.Name</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="yearInput">Year</label>
                        <input class="form-control"
                               id="yearInput"
                               type="number"
                               name="year"
                               value="@(Model.Year?.ToString() ?? string.Empty)"
                               min="1900"
                               max="2100" />
                    </div>

                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               id="includeInactiveChk"
                               name="includeInactive"
                               value="true"
                               @(Model.IncludeInactive ? "checked" : null) />
                        <label class="form-check-label" for="includeInactiveChk">
                            Include inactive
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Apply</button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>
