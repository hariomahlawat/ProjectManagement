@page
@model ProjectManagement.Areas.DocumentRepository.Pages.Documents.IndexModel
@using ProjectManagement.Data.DocRepo
@using ProjectManagement.Models
@{
    ViewData["Title"] = "Document repository";
}

<partial name="~/Views/Shared/_Breadcrumbs.cshtml" model='new BreadcrumbModel(
                                                       ("Documents", null)
                                                   )' />

<div class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h1 class="h4 mb-0">Document repository</h1>
        <div class="d-flex gap-2">
            <authorize policy="DocRepo.DeleteApprove">
                <a asp-area="DocumentRepository"
                   asp-page="/Admin/DeleteRequests/Index"
                   class="btn btn-outline-danger">
                    Delete requests
                </a>
            </authorize>

            <authorize policy="DocRepo.Upload">
                <a asp-page="./Upload" class="btn btn-primary">
                    <i class="bi bi-upload me-1"></i> Upload
                </a>
            </authorize>
        </div>
    </div>

    <form method="get" class="row g-2 mb-4" data-docrepo-filter>
        <div class="col-sm-4 col-lg-3">
            <input class="form-control" type="search" name="q" value="@Model.Q" placeholder="Search subject / sender / tag" />
        </div>
        <div class="col-sm-3 col-lg-2">
            <input class="form-control" name="tag" value="@Model.Tag" placeholder="Tag" />
        </div>
        <div class="col-sm-3 col-lg-2">
            <select class="form-select" name="officeCategoryId">
                <option value="">All offices</option>
                @foreach (var office in Model.OfficeCategories)
                {
                    <option value="@office.Id" selected="@(Model.OfficeCategoryId == office.Id ? "selected" : null)">@office.Name</option>
                }
            </select>
        </div>
        <div class="col-sm-3 col-lg-2">
            <select class="form-select" name="documentCategoryId">
                <option value="">All document type</option>
                @foreach (var docCat in Model.DocumentCategories)
                {
                    <option value="@docCat.Id" selected="@(Model.DocumentCategoryId == docCat.Id ? "selected" : null)">@docCat.Name</option>
                }
            </select>
        </div>
        <div class="col-sm-2 col-lg-1">
            <input class="form-control" type="number" name="year" value="@(Model.Year?.ToString() ?? string.Empty)" placeholder="Year" min="1900" max="2100" />
        </div>
        <div class="col-sm-3 col-lg-2 d-flex align-items-center">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="includeInactive"
                       name="includeInactive" value="true" @(Model.IncludeInactive ? "checked" : null) />
                <label class="form-check-label" for="includeInactive">Include inactive</label>
            </div>
        </div>
        <div class="col-sm-2 col-lg-1">
            <button type="submit" class="btn btn-outline-secondary w-100">Filter</button>
        </div>
        <input type="hidden" name="page" value="1" />
        <input type="hidden" name="pageSize" value="@Model.PageSize" />
    </form>

    <partial name="_Pager" model="new PagerModel(Model.PageNumber, Model.PageSize, Model.TotalCount, Request)" />

    @if (!Model.Items.Any())
    {
        <div class="card border-0 bg-light-subtle">
            <div class="card-body py-5 text-center text-muted">
                <i class="bi bi-inbox display-5 d-block mb-2"></i>
                <div class="fw-semibold">No documents found</div>
                <div>Try adjusting filters or upload a new document.</div>
                <authorize policy="DocRepo.Upload">
                    <div class="mt-3">
                        <a asp-page="./Upload" class="btn btn-primary btn-sm">
                            <i class="bi bi-upload me-1"></i> Upload
                        </a>
                    </div>
                </authorize>
            </div>
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3">
            @foreach (var d in Model.Items)
            {
                <div class="col">
                    <partial name="_DocumentCard" model="d" />
                </div>
            }
        </div>
    }

    <partial name="_Pager" model="new PagerModel(Model.PageNumber, Model.PageSize, Model.TotalCount, Request)" />
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/docrepo-ui.css" asp-append-version="true" />
}
