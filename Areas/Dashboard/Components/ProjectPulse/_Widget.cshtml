@model ProjectManagement.Areas.Dashboard.Components.ProjectPulse.ProjectPulseVm
@using System.Collections.Generic
@using System.Text.Json

@* SECTION: Serialization helpers *@
@{
    var jsonOptions = new JsonSerializerOptions(JsonSerializerDefaults.Web);
    string Serialize<T>(IReadOnlyList<T> source) => JsonSerializer.Serialize(source, jsonOptions);
}
@* END SECTION *@

<section class="ppulse" data-project-pulse>
  @* SECTION: Header *@
  <div class="ppulse__head">
    <div class="ppulse__title">
      <span class="ppulse__pulse" aria-hidden="true"></span>
      <h2 class="ppulse__h">Project pulse</h2>
    </div>
    <div class="ppulse__actions">
      <span class="ppulse__pill" title="Projects eligible for proliferation">
        Available for proliferation <strong>@Model.ProliferationEligible</strong>
      </span>
      <a
        class="btn btn-primary btn-sm ppulse__analytics"
        href="@Model.AnalyticsUrl"
        aria-label="Open analytics dashboard"
      >
        Open analytics
      </a>
    </div>
  </div>
  @* END SECTION *@

  @* SECTION: Content cards *@
  <div class="ppulse__grid">
    <article class="ppulse__card">
      <a class="ppulse__link" href="@Model.CompletedUrl">
        <header class="ppulse__card-head">
          <h3>Completed <small>@Model.CompletedCount</small></h3>
        </header>
        <div
          class="ppulse__chart"
          data-chart="donut"
          data-series='@Html.Raw(Serialize(Model.CompletedByProjectCategory))'
        >
          <canvas aria-hidden="true"></canvas>
        </div>
        <footer class="ppulse__foot">View completed →</footer>
      </a>
    </article>

    <article class="ppulse__card">
      <a class="ppulse__link" href="@Model.OngoingUrl">
        <header class="ppulse__card-head">
          <h3>Ongoing <small>@Model.OngoingCount</small></h3>
        </header>
        <div
          class="ppulse__chart"
          data-chart="line"
          data-series='@Html.Raw(Serialize(Model.OngoingByStageOrdered))'
        >
          <canvas aria-hidden="true"></canvas>
        </div>
        <footer class="ppulse__foot">View ongoing →</footer>
      </a>
    </article>

    <article class="ppulse__card">
      <a class="ppulse__link" href="@Model.RepositoryUrl">
        <header class="ppulse__card-head">
          <h3>All projects <small>@Model.TotalProjects</small></h3>
        </header>
        <div
          class="ppulse__chart"
          data-chart="bar"
          data-series='@Html.Raw(Serialize(Model.AllByTechnicalCategoryTop))'
        >
          <canvas aria-hidden="true"></canvas>
        </div>
        @if (Model.RemainingTechCategories > 0)
        {
          <div class="ppulse__hint">+@Model.RemainingTechCategories more categories</div>
        }
        <footer class="ppulse__foot">Explore repository →</footer>
      </a>
    </article>
  </div>
  @* END SECTION *@
</section>
