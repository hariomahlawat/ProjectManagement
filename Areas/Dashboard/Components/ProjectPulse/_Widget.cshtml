@model ProjectManagement.Areas.Dashboard.Components.ProjectPulse.ProjectPulseVm
@using System.Collections.Generic
@using System.Text.Json

@* SECTION: Serialization helpers *@
@{
    var jsonOptions = new JsonSerializerOptions(JsonSerializerDefaults.Web);
    string Serialize<T>(IReadOnlyList<T> source) => JsonSerializer.Serialize(source, jsonOptions);
    var widgetClass = Model.Condensed ? "ppulse ppulse--condensed" : "ppulse";
}
@* END SECTION *@

<section class="@widgetClass" data-project-pulse>
  @* SECTION: Header *@
  <header class="ppulse__head">
    <div class="ppulse__title">
      <i class="bi bi-activity" aria-hidden="true"></i>
      <h2 class="h5 mb-0">Project pulse</h2>
    </div>
    <ul class="ppulse__kpis" aria-label="Project metrics">
      <li class="ppulse__pill">
        <span class="ppulse__pill-label">Total</span>
        <span class="ppulse__pill-value">@Model.TotalProjects</span>
      </li>
      <li class="ppulse__pill">
        <span class="ppulse__pill-label">Completed</span>
        <span class="ppulse__pill-value">@Model.CompletedCount</span>
      </li>
      <li class="ppulse__pill">
        <span class="ppulse__pill-label">Ongoing</span>
        <span class="ppulse__pill-value">@Model.OngoingCount</span>
      </li>
      <li class="ppulse__pill">
        <span class="ppulse__pill-label">Idle</span>
        <span class="ppulse__pill-value">@Model.IdleCount</span>
      </li>
      <li
        class="ppulse__pill ppulse__pill--accent"
        title="Completed and eligible, not yet proliferated"
      >
        <span class="ppulse__pill-label">Available for proliferation</span>
        <span class="ppulse__pill-value">@Model.AvailableForProliferationCount</span>
      </li>
    </ul>
  </header>
  @* END SECTION *@

  @* SECTION: Cards *@
  <div class="ppulse__grid">
    <article class="ppulse__card" aria-labelledby="ppulse-card-completed">
      <div class="ppulse__card-head">
        <h3 id="ppulse-card-completed">Completed <small>@Model.CompletedCount</small></h3>
      </div>
      <div
        class="ppulse__chart"
        data-chart="pie"
        data-series='@Html.Raw(Serialize(Model.CompletedByProjectCategory))'
      >
        <canvas aria-hidden="true"></canvas>
      </div>
      <div class="ppulse__card-foot">
        <a class="ppulse__link" asp-page="/Projects/CompletedSummary/Index">View completed →</a>
      </div>
    </article>

    <article class="ppulse__card" aria-labelledby="ppulse-card-ongoing">
      <div class="ppulse__card-head">
        <h3 id="ppulse-card-ongoing">Ongoing <small>@Model.OngoingCount</small></h3>
      </div>
      <div
        class="ppulse__chart"
        data-chart="line"
        data-series='@Html.Raw(Serialize(Model.OngoingByStage))'
        data-x-axis-title="Stages"
        data-x-axis-hide-labels="true"
      >
        <canvas aria-hidden="true"></canvas>
      </div>
      <div class="ppulse__card-foot">
        <a class="ppulse__link" asp-page="/Projects/Ongoing/Index">View ongoing →</a>
      </div>
    </article>

    <article class="ppulse__card" aria-labelledby="ppulse-card-all">
      <div class="ppulse__card-head">
        <h3 id="ppulse-card-all">All projects <small>@Model.TotalProjects</small></h3>
      </div>
      <div
        class="ppulse__chart"
        data-chart="bar"
        data-series='@Html.Raw(Serialize(Model.AllByTechnicalCategory))'
        data-x-axis-title="Technical category"
        data-x-axis-hide-labels="true"
      >
        <canvas aria-hidden="true"></canvas>
      </div>
      <div class="ppulse__card-foot">
        <a class="ppulse__link" asp-page="/Projects/Index">Explore repository →</a>
      </div>
    </article>

    <aside class="ppulse__cta" aria-labelledby="ppulse-card-cta">
      <div class="ppulse__cta-body">
        <h3 id="ppulse-card-cta">Deep dive</h3>
        <p>Trends, drill-downs, and downloads.</p>
        <a class="btn btn-primary" asp-page="/Analytics/Index">Open analytics</a>
      </div>
    </aside>
  </div>
  @* END SECTION *@
</section>
