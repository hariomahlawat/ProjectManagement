@page
@model ProjectManagement.Areas.Admin.Pages.Users.IndexModel
<h3>Users</h3>
<p><a class="btn pm-btn-primary" asp-page="Create">Create user</a></p>
<input id="userSearch" class="form-control mb-3" type="search" placeholder="Search by username or role" />
<table class="table table-sm" id="usersTable">
  <thead>
    <tr>
      <th scope="col">UserName</th>
      <th scope="col">Roles</th>
      <th scope="col">Last login</th>
      <th scope="col">Total logins</th>
      <th scope="col">Status</th>
      <th scope="col" class="text-end">Actions</th>
    </tr>
  </thead>
  <tbody>
  @foreach (var row in Model.Users)
  {
    <tr>
      <td class="text-start">@row.UserName</td>
      <td class="text-start">
        @foreach (var r in row.Roles)
        {
          <span class="badge bg-secondary me-1">@r</span>
        }
      </td>
      <td>@(row.LastLoginUtc?.ToString("yyyy-MM-dd HH:mm") ?? "-")</td>
      <td>@row.LoginCount</td>
      <td>
        <span class="badge @(row.IsActive ? "bg-success" : "bg-danger")">@(row.IsActive ? "Active" : "Disabled")</span>
      </td>
      <td class="text-end">
        <div class="d-flex justify-content-end gap-1">
          <a asp-page="Edit" asp-route-id="@row.Id" class="btn btn-sm btn-outline-secondary" title="Edit user">Edit</a>
          <a asp-page="Reset" asp-route-id="@row.Id" class="btn btn-sm btn-outline-secondary" title="Reset password">Reset</a>
          <form method="post" asp-page="Delete" asp-route-id="@row.Id" class="d-inline">
            <button type="submit" class="btn btn-sm btn-outline-danger delete-user-btn" data-username="@row.UserName" title="Delete user">Delete</button>
          </form>
        </div>
      </td>
    </tr>
  }
  </tbody>
</table>

@section Scripts {
    <script type="module" src="~/js/users/index.js" asp-append-version="true"></script>
}
