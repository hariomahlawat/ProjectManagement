@page "{id}"
@model ProjectManagement.Areas.Admin.Pages.Users.DeleteModel
<nav aria-label="breadcrumb" class="mb-2">
  <ol class="breadcrumb small mb-0">
    <li class="breadcrumb-item"><a asp-area="Admin" asp-page="/Index">Admin</a></li>
    <li class="breadcrumb-item"><a asp-area="Admin" asp-page="/Users/Index">Users</a></li>
    <li class="breadcrumb-item active" aria-current="page">Delete</li>
  </ol>
</nav>
<h4 class="mb-2">Delete account?</h4>
@if (Model.UserEntity?.PendingDeletion ?? false)
{
    var due = Model.UserEntity.DeletionRequestedUtc!.Value.AddMinutes(Model.Options.UndoWindowMinutes);
    <div class="alert alert-warning">
        Account scheduled for deletion at @TimeFmt.ToIst(due).
    </div>
    @if (DateTime.UtcNow < due)
    {
        <form method="post" asp-page-handler="Undo">
            <button class="btn btn-danger" type="submit">Undo</button>
            <a asp-page="Index" class="btn btn-secondary">Back</a>
        </form>
    }
    else
    {
        <a asp-page="Index" class="btn btn-secondary">Back</a>
    }
}
else if (Model.UserEntity is not null)
{
<div class="pm-card pm-shadow p-4 p-md-5">
  <p>Deleting an account permanently removes the userâ€™s sign-in and access. Project records previously created by this user will <strong>not</strong> be removed, but they may lose their owner/author link and any remarks or comments may lose their association. Only delete accounts that were created by mistake. For all other cases, <strong>disable</strong> the account instead.</p>
  <p>This action can be undone for the next <strong>@Model.Options.UndoWindowMinutes minutes</strong>, after which it is irreversible.</p>
  <form method="post" id="deleteForm">
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
    <input id="confirmUser" asp-for="ConfirmUser" class="form-control" placeholder="Type username to confirm" data-expected="@Model.UserEntity.UserName" data-button="btnDelete" />
    <div class="form-check mt-2">
      <input class="form-check-input" asp-for="Ack" id="ack" />
      <label class="form-check-label" for="ack">I understand this is permanent after the undo window.</label>
    </div>
    <button id="btnDelete" type="button" class="btn btn-danger mt-3" data-bs-toggle="modal" data-bs-target="#confirmDelete" disabled>Delete account</button>
    <a asp-page="Index" class="btn btn-secondary mt-3">Cancel</a>
  </form>
  <partial name="../Shared/_ConfirmModal" model="@(new ConfirmModal("confirmDelete", "Delete account", "This action cannot be undone after the grace period.", "deleteForm", "Delete"))" />
</div>
@section Scripts {
  <script type="module" src="~/js/users/confirm-user.js" asp-append-version="true"></script>
}
}
