@page
@model ProjectManagement.Areas.Admin.Pages.Analytics.IndexModel
@{
  ViewData["Title"] = "Analytics";
}
<h3 class="mb-3">Analytics</h3>

<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="pm-card pm-shadow p-3">
      <div class="text-muted">Logins today</div>
      <div class="d-flex justify-content-between align-items-end">
        <div class="fs-3">
          @{ var loginsToday = Model.LoginsLast30Days[^1]; var loginsYesterday = Model.LoginsLast30Days.Length > 1 ? Model.LoginsLast30Days[^2] : 0; var diff = loginsToday - loginsYesterday; }
          @loginsToday
          <span class="fs-6 text-muted">@(diff >= 0 ? "▲" : "▼")@Math.Abs(diff)</span>
        </div>
        <div class="sparkline" data-points="@string.Join(',', Model.LoginsLast30Days.Skip(Math.Max(0, Model.LoginsLast30Days.Length-7)))"></div>
      </div>
    </div>
  </div>
  <div class="col-md-3"><div class="pm-card pm-shadow p-3"><div class="text-muted">Total users</div><div class="fs-3">@Model.TotalUsers</div></div></div>
  <div class="col-md-3"><div class="pm-card pm-shadow p-3"><div class="text-muted">Active</div><div class="fs-3">@Model.ActiveUsers</div></div></div>
  <div class="col-md-3"><div class="pm-card pm-shadow p-3"><div class="text-muted">Disabled</div><div class="fs-3">@Model.DisabledUsers</div></div></div>
</div>

<div class="pm-card pm-shadow p-3 mb-4">
  <h5 class="mb-3">Logins per day (last 30 days)</h5>
  <table class="table table-sm">
    <thead><tr><th>Date</th><th>Logins</th></tr></thead>
    <tbody>
      @foreach (var d in Model.LoginsPerDay)
      { <tr><td>@d.Date.ToString("yyyy-MM-dd")</td><td>@d.Count</td></tr> }
    </tbody>
  </table>
</div>

<div class="pm-card pm-shadow p-3">
  <h5 class="mb-3">Top users by logins</h5>
  <table class="table table-sm">
    <thead><tr><th>User</th><th>Last login</th><th>Total logins</th></tr></thead>
    <tbody>
      @foreach (var u in Model.TopUsers)
      { <tr><td>@u.UserName</td><td>@(u.LastLogin?.ToString("yyyy-MM-dd HH:mm") ?? "-")</td><td>@u.Count</td></tr> }
    </tbody>
  </table>
</div>
